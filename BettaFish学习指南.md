# ğŸŸ BettaFish å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿæ·±åº¦å­¦ä¹ æŒ‡å—

> **å­¦ä¹ é‡ç‚¹**ï¼šâ­ **å¤šæ™ºèƒ½ä½“åä½œæœºåˆ¶** | â­ **å››å¤§Agentå†…éƒ¨è®¾è®¡** | â­ **è®ºå›åä½œå®ç°**
> **ç®€åŒ–å†…å®¹**ï¼šğŸ”¹ LLMæŠ€æœ¯ï¼ˆé™„å½•ï¼‰ | ğŸ”¹ çˆ¬è™«æŠ€æœ¯ï¼ˆé™„å½•ï¼‰

---

## ğŸ“š å­¦ä¹ è·¯çº¿

```
ç¬¬ä¸€é˜¶æ®µï¼šé¡¹ç›®å…¨æ™¯è®¤çŸ¥ ï¼ˆ1å¤©ï¼‰
    â”œâ”€ å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ˜¯ä»€ä¹ˆ
    â””â”€ BettaFishçš„æ ¸å¿ƒä»·å€¼
         â†“
ç¬¬äºŒé˜¶æ®µï¼šå¤šæ™ºèƒ½ä½“ç†è®ºä¸æ¶æ„ ï¼ˆ2-3å¤©ï¼‰â­
    â”œâ”€ Agentçš„æœ¬è´¨ä¸è®¾è®¡æ¨¡å¼
    â”œâ”€ åä½œæ¨¡å¼å¯¹æ¯”
    â””â”€ å››ä¸ªAgentçš„èŒè´£åˆ’åˆ†
         â†“
ç¬¬ä¸‰é˜¶æ®µï¼šè®ºå›åä½œæœºåˆ¶æ·±åº¦è§£æ ï¼ˆ3-4å¤©ï¼‰â­
    â”œâ”€ ä¸ºä»€ä¹ˆéœ€è¦è®ºå›æœºåˆ¶
    â”œâ”€ å®ç°åŸç†ï¼ˆåŸºäºæ—¥å¿—æ–‡ä»¶ï¼‰
    â”œâ”€ ä»£ç é€è¡Œå‰–æï¼ˆForumEngine/monitor.pyï¼‰
    â””â”€ ä¸»æŒäººLLMçš„ä½œç”¨
         â†“
ç¬¬å››é˜¶æ®µï¼šInsightEngineæ·±åº¦å‰–æ ï¼ˆ4-5å¤©ï¼‰â­
    â”œâ”€ å†…éƒ¨æ¶æ„ä¸å·¥å…·ç®±
    â”œâ”€ NodeèŠ‚ç‚¹è®¾è®¡æ¨¡å¼
    â”œâ”€ å…³é”®ä»£ç è§£æï¼ˆagent.pyï¼‰
    â””â”€ å·¥ä½œæµç¨‹å®æˆ˜
         â†“
ç¬¬äº”é˜¶æ®µï¼šå…¶ä»–ä¸‰ä¸ªAgentè§£æ ï¼ˆå„2å¤©ï¼‰â­
    â”œâ”€ QueryEngineï¼ˆç½‘ç»œæœç´¢ï¼‰
    â”œâ”€ MediaEngineï¼ˆå¤šæ¨¡æ€åˆ†æï¼‰
    â””â”€ ReportEngineï¼ˆæŠ¥å‘Šç”Ÿæˆï¼‰
         â†“
ç¬¬å…­é˜¶æ®µï¼šå®Œæ•´åä½œæµç¨‹å®æˆ˜ ï¼ˆ2-3å¤©ï¼‰
    â””â”€ ä»ç”¨æˆ·æé—®åˆ°æŠ¥å‘Šç”Ÿæˆå…¨æµç¨‹
```

**æ€»è®¡å­¦ä¹ æ—¶é—´**ï¼šçº¦ 18-22 å¤©

---

## ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šé¡¹ç›®å…¨æ™¯è®¤çŸ¥

### 1.1 BettaFishæ˜¯ä»€ä¹ˆï¼Ÿ

**ä¸€å¥è¯å®šä¹‰**ï¼šä¸€ä¸ªåŸºäº**å¤šæ™ºèƒ½ä½“åä½œ**çš„èˆ†æƒ…åˆ†æç³»ç»Ÿï¼Œé€šè¿‡4ä¸ªä¸“ä¸šAI Agentçš„åˆ†å·¥åˆä½œï¼Œè‡ªåŠ¨å®Œæˆå¤æ‚çš„èˆ†æƒ…åˆ†æä»»åŠ¡ã€‚

#### æ ¸å¿ƒç±»æ¯”ï¼šAIæƒ…æŠ¥åˆ†æå›¢é˜Ÿ

æƒ³è±¡ä¸€ä¸ªæƒ…æŠ¥åˆ†æå›¢é˜Ÿåœ¨åˆ†ææŸä¸ªäº‹ä»¶ï¼š

```
ä¼ ç»Ÿäººç±»å›¢é˜Ÿ                      BettaFish AIå›¢é˜Ÿ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¤ ç½‘ç»œæœç´¢å‘˜              â†’    QueryEngine
   èŒè´£ï¼šæœç´¢æ–°é—»ã€ç¤¾äº¤åª’ä½“             èŒè´£ï¼šè°ƒç”¨æœç´¢APIè·å–ç½‘ç»œä¿¡æ¯
   å·¥å…·ï¼šGoogleã€å¾®åšæœç´¢               å·¥å…·ï¼šTavily APIã€Bocha API

ğŸ‘¤ å¤šåª’ä½“ä¸“å®¶              â†’    MediaEngine
   èŒè´£ï¼šåˆ†æå›¾ç‰‡ã€è§†é¢‘å†…å®¹             èŒè´£ï¼šè§£æå¤šæ¨¡æ€æ•°æ®
   å·¥å…·ï¼šPhotoshopã€è§†é¢‘ç¼–è¾‘å™¨          å·¥å…·ï¼šå¤šæ¨¡æ€LLMï¼ˆGeminiï¼‰

ğŸ‘¤ æ•°æ®åˆ†æå¸ˆ              â†’    InsightEngine
   èŒè´£ï¼šæŒ–æ˜æ•°æ®åº“æ·±åº¦ä¿¡æ¯             èŒè´£ï¼šSQLæŸ¥è¯¢ã€æƒ…æ„Ÿåˆ†æ
   å·¥å…·ï¼šExcelã€SQLã€ç»Ÿè®¡è½¯ä»¶           å·¥å…·ï¼šæ•°æ®åº“æŸ¥è¯¢å·¥å…·ã€æƒ…æ„Ÿåˆ†ææ¨¡å‹

ğŸ‘¤ æŠ¥å‘Šæ’°å†™å‘˜              â†’    ReportEngine
   èŒè´£ï¼šæ•´åˆä¿¡æ¯ï¼Œæ’°å†™æŠ¥å‘Š             èŒè´£ï¼šæ”¶é›†ç»“æœï¼Œç”ŸæˆHTMLæŠ¥å‘Š
   å·¥å…·ï¼šWordã€PPT                     å·¥å…·ï¼šæ¨¡æ¿å¼•æ“ã€Markdownè½¬HTML

ğŸ™ï¸ å›¢é˜Ÿä¸»æŒäºº              â†’    ForumEngine
   èŒè´£ï¼šåè°ƒè®¨è®ºï¼Œå¼•å¯¼æ–¹å‘             èŒè´£ï¼šç›‘æ§Agentæ—¥å¿—ï¼Œç”Ÿæˆæ€»ç»“
   å·¥å…·ï¼šä¼šè®®è®°å½•ã€ç™½æ¿                 å·¥å…·ï¼šæ—¥å¿—ç›‘æ§ã€ä¸»æŒäººLLM
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¤šAgentï¼Ÿ

#### å•Agentï¼ˆå•ä¸ªLLMï¼‰çš„å±€é™æ€§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å•ä¸ªLLMçš„"èƒ½åŠ›è¾¹ç•Œ"            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ æ— æ³•è®¿é—®å®æ—¶ç½‘ç»œæ•°æ®             â”‚
â”‚ âŒ æ— æ³•æŸ¥è¯¢æ•°æ®åº“                  â”‚
â”‚ âŒ æ— æ³•ç†è§£å›¾ç‰‡ã€è§†é¢‘               â”‚
â”‚ âŒ çŸ¥è¯†æˆªæ­¢æ—¥æœŸé™åˆ¶                 â”‚
â”‚ âŒ å®¹æ˜“äº§ç”Ÿ"æ€ç»´èŒ§æˆ¿"              â”‚
â”‚ âŒ æ— æ³•å¹¶è¡Œå¤„ç†å¤šä¸ªä»»åŠ¡             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¤šAgentåä½œçš„ä¼˜åŠ¿

| ç»´åº¦ | å•Agent | å¤šAgentåä½œ | BettaFishçš„å®ç° |
|------|---------|------------|---------------|
| **èƒ½åŠ›èŒƒå›´** | ä»…é™LLMæ¨ç† | æ¯ä¸ªAgentæœ‰ä¸“ä¸šå·¥å…· | 4ä¸ªAgentè¦†ç›–æœç´¢ã€å¤šæ¨¡æ€ã€æ•°æ®åº“ã€æŠ¥å‘Šç”Ÿæˆ |
| **ä¿¡æ¯æ¥æº** | è®­ç»ƒæ•°æ® | ç½‘ç»œ+æ•°æ®åº“+å¤šæ¨¡æ€ | æ•´åˆ30+ç¤¾äº¤åª’ä½“+ç§æœ‰æ•°æ®åº“ |
| **å¤„ç†æ•ˆç‡** | ä¸²è¡Œæ‰§è¡Œ | å¹¶è¡Œå¤„ç† | ä¸‰ä¸ªAgentåŒæ—¶å¯åŠ¨å·¥ä½œ |
| **è§†è§’å¤šå…ƒæ€§** | å•ä¸€è§†è§’ | å¤šå…ƒäº¤å‰éªŒè¯ | è®ºå›æœºåˆ¶è®©Agentäº’ç›¸å¯å‘ |
| **ç»“æœè´¨é‡** | æ˜“ç‰‡é¢ | ç»¼åˆèåˆ | ReportEngineæ•´åˆæ‰€æœ‰å‘ç° |

### 1.3 BettaFishçš„æ ¸å¿ƒä»·å€¼

**ä¸‰æ¿æ–§**ï¼šè¾“å…¥éœ€æ±‚ â†’ è¯¦ç»†åˆ†æ â†’ è¶‹åŠ¿é¢„æµ‹ï¼ˆå¼€å‘ä¸­ï¼‰

```
ã€è¾“å…¥ã€‘ç”¨æˆ·åœ¨Webç•Œé¢æå‡ºåˆ†æéœ€æ±‚
  ä¾‹å¦‚ï¼š"åˆ†ææ­¦æ±‰å¤§å­¦å“ç‰Œå£°èª‰"
      â†“
ã€åˆ†æã€‘ä¸‰ä¸ªAgentå¹¶è¡Œå·¥ä½œ + è®ºå›åä½œ
  â”œâ”€ QueryEngine: æœç´¢å…¨ç½‘æ–°é—»ã€ç¤¾äº¤åª’ä½“è®¨è®º
  â”œâ”€ MediaEngine: åˆ†æç›¸å…³å›¾ç‰‡ã€è§†é¢‘å†…å®¹
  â””â”€ InsightEngine: æŸ¥è¯¢æ•°æ®åº“å†å²æ•°æ®ã€æƒ…æ„Ÿåˆ†æ
      â†“
  ForumEngine: ç›‘æ§æ‰€æœ‰Agentå‘è¨€ï¼Œå¼•å¯¼æ·±åº¦ç ”ç©¶
      â†“
ã€æŠ¥å‘Šã€‘ReportEngineç”Ÿæˆä¸“ä¸šHTMLæŠ¥å‘Š
  åŒ…å«ï¼šçƒ­ç‚¹è¯é¢˜ã€èˆ†æƒ…èµ°å‘ã€æƒ…æ„Ÿåˆ†æã€å…³é”®äº‹ä»¶
      â†“
ã€é¢„æµ‹ã€‘ï¼ˆå¼€å‘ä¸­ï¼‰åŸºäºæ—¶åºæ¨¡å‹é¢„æµ‹æœªæ¥è¶‹åŠ¿
```

---

## ğŸ§  ç¬¬äºŒé˜¶æ®µï¼šå¤šæ™ºèƒ½ä½“ç†è®ºä¸æ¶æ„ï¼ˆâ­ é‡ç‚¹ï¼‰

### 2.1 ä»€ä¹ˆæ˜¯Agentï¼ˆæ™ºèƒ½ä½“ï¼‰ï¼Ÿ

#### å¤§ç™½è¯è§£é‡Š

**Agent = å¤§è„‘ï¼ˆLLMï¼‰ + å·¥å…·ï¼ˆToolsï¼‰ + è‡ªä¸»å†³ç­–èƒ½åŠ›**

ç±»æ¯”ï¼šä¸€ä¸ªè£…ä¿®å·¥äºº
- **å¤§è„‘**ï¼ˆLLMï¼‰ï¼šç†è§£éœ€æ±‚"æˆ‘è¦è£…ä¿®å®¢å…"
- **å·¥å…·**ï¼ˆToolsï¼‰ï¼šç”µé’»ã€é”¤å­ã€å·å°º
- **è‡ªä¸»å†³ç­–**ï¼šå…ˆæµ‹é‡â†’é€‰æ‹©å·¥å…·â†’æ‰§è¡Œâ†’æ£€æŸ¥è´¨é‡

#### ä¸“ä¸šå®šä¹‰ï¼šPRARå¾ªç¯

Agentçš„å·¥ä½œéµå¾ª**PRARå¾ªç¯**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Agent çš„ PRAR å¾ªç¯            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  1. Perceive  (æ„ŸçŸ¥)                â”‚
â”‚     â†“ æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢/è¯»å–ç¯å¢ƒä¿¡æ¯      â”‚
â”‚                                     â”‚
â”‚  2. Reason    (æ¨ç†)                â”‚
â”‚     â†“ LLMç†è§£ä»»åŠ¡,åˆ¶å®šç­–ç•¥           â”‚
â”‚                                     â”‚
â”‚  3. Act       (è¡ŒåŠ¨)                â”‚
â”‚     â†“ è°ƒç”¨å·¥å…·æ‰§è¡Œä»»åŠ¡               â”‚
â”‚                                     â”‚
â”‚  4. Reflect   (åæ€)                â”‚
â”‚     â†“ è¯„ä¼°ç»“æœ,å†³å®šæ˜¯å¦é‡è¯•          â”‚
â”‚     â”‚                               â”‚
â”‚     â””â”€â”€â†’ (å¾ªç¯å›åˆ°ç¬¬1æ­¥)            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### BettaFishä¸­Agentçš„é€šç”¨ç»“æ„

```python
# ä¼ªä»£ç ï¼šå±•ç¤ºAgentçš„æ ¸å¿ƒç»„æˆ
class Agent:
    def __init__(self):
        self.llm_client = LLM()        # å¤§è„‘ï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰
        self.tools = ToolBox()         # å·¥å…·ç®±ï¼ˆä¸“ä¸šèƒ½åŠ›ï¼‰
        self.nodes = NodePipeline()    # èŠ‚ç‚¹æµæ°´çº¿ï¼ˆå¤„ç†æµç¨‹ï¼‰
        self.state = State()           # çŠ¶æ€ç®¡ç†

    def run(self, user_query):
        # 1. Perceive: æ„ŸçŸ¥è¾“å…¥
        task = self.understand_query(user_query)

        # 2. Reason: æ¨ç†å†³ç­–
        plan = self.llm_client.make_plan(task)

        # 3. Act: æ‰§è¡Œè¡ŒåŠ¨
        results = self.execute_plan(plan)

        # 4. Reflect: åæ€ä¼˜åŒ–
        if not self.is_good_enough(results):
            return self.run(user_query)  # é‡æ–°æ‰§è¡Œ

        return results
```

### 2.2 BettaFishçš„å››ä¸ªAgentè¯¦è§£

#### èŒè´£åˆ’åˆ†åŸåˆ™ï¼šæŒ‰ä¿¡æ¯æ¥æºå’Œå¤„ç†èƒ½åŠ›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             å››ä¸ªAgentçš„èŒè´£çŸ©é˜µ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agent      â”‚ ä¿¡æ¯æ¥æº     â”‚ æ ¸å¿ƒèƒ½åŠ›     â”‚ å…³é”®å·¥å…· â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚QueryEngine â”‚ äº’è”ç½‘å…¬å¼€   â”‚ ç½‘ç»œæœç´¢     â”‚Tavily   â”‚
â”‚            â”‚ ä¿¡æ¯         â”‚ å†…å®¹æå–     â”‚Bocha APIâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚MediaEngine â”‚ å›¾ç‰‡ã€è§†é¢‘   â”‚ è§†è§‰ç†è§£     â”‚Gemini   â”‚
â”‚            â”‚ ç­‰å¤šæ¨¡æ€å†…å®¹ â”‚ OCRæå–      â”‚å¤šæ¨¡æ€LLMâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Insight     â”‚ ç§æœ‰æ•°æ®åº“   â”‚ æ•°æ®æŒ–æ˜     â”‚SQLæŸ¥è¯¢  â”‚
â”‚Engine      â”‚ (èˆ†æƒ…æ•°æ®)   â”‚ æƒ…æ„Ÿåˆ†æ     â”‚æƒ…æ„Ÿæ¨¡å‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Report      â”‚ å…¶ä»–Agentçš„  â”‚ å†…å®¹æ•´åˆ     â”‚æ¨¡æ¿å¼•æ“ â”‚
â”‚Engine      â”‚ åˆ†æç»“æœ     â”‚ æŠ¥å‘Šç”Ÿæˆ     â”‚Markdown â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Agenté—´çš„ä¿¡æ¯æµåŠ¨

```
ç”¨æˆ·æé—®ï¼š"åˆ†ææ­¦æ±‰å¤§å­¦å“ç‰Œå£°èª‰"
         â†“
   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
   â”‚  Flask    â”‚  ä¸»åº”ç”¨åˆ†å‘ä»»åŠ¡
   â”‚  app.py   â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”˜
       â”‚   â”‚   â”‚
   â”Œâ”€â”€â”€â”´â” â”Œâ”´â”€â”€â”â”Œâ”´â”€â”€â”€â”
   â”‚Queryâ”‚â”‚Mediaâ”‚â”‚Insightâ”‚  ä¸‰ä¸ªAgentå¹¶è¡Œå¯åŠ¨
   â”‚Engineâ”‚â”‚Engineâ”‚â”‚Engineâ”‚
   â””â”€â”€â”€â”¬â”˜ â””â”¬â”€â”€â”˜â””â”¬â”€â”€â”€â”˜
       â”‚   â”‚   â”‚
       â”‚   â”‚   â”‚  å„è‡ªä½¿ç”¨ä¸“ä¸šå·¥å…·æœç´¢
       â”‚   â”‚   â”‚
       â†“   â†“   â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ForumEngine  â”‚  ç›‘æ§æ—¥å¿—,åè°ƒè®¨è®º
    â”‚  (ç›‘æ§+ä¸»æŒ)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    ã€è®ºå›æ€»ç»“ã€‘
    "QueryEngineå‘ç°:æ¨±èŠ±å­£æ˜¯çƒ­ç‚¹"
    "MediaEngineå‘ç°:å¤§é‡è§†é¢‘æåˆ°æ¨±èŠ±"
    "InsightEngineå‘ç°:è®¨è®ºé‡å¢é•¿300%"
         â†“
    å„Agentè¯»å–è®ºå›,è°ƒæ•´ç­–ç•¥
         â†“
    æ·±åº¦ç ”ç©¶ï¼ˆå¤šè½®è¿­ä»£ï¼‰
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ReportEngine  â”‚  æ”¶é›†æ‰€æœ‰ç»“æœ
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    ç”ŸæˆHTMLæŠ¥å‘Š
```

### 2.3 å¤šæ™ºèƒ½ä½“åä½œæ¨¡å¼å¯¹æ¯”

#### ä¸‰ç§ç»å…¸æ¨¡å¼

**1. ä¸²è¡Œæ¨¡å¼ï¼ˆSequentialï¼‰**
```
Agent A â†’ Agent B â†’ Agent C
  â””â”€ ä¼˜ç‚¹ï¼šé€»è¾‘æ¸…æ™°,æ˜“äºè°ƒè¯•
  â””â”€ ç¼ºç‚¹ï¼šé€Ÿåº¦æ…¢,Aæ…¢åˆ™å…¨æ…¢
  â””â”€ BettaFishé‡‡ç”¨ï¼šâŒ ä¸é‡‡ç”¨
```

**2. å¹¶è¡Œæ¨¡å¼ï¼ˆParallelï¼‰**
```
     â”Œâ”€ Agent A â”€â”
ä»»åŠ¡ â”€â”¼â”€ Agent B â”€â”¼â†’ ç»“æœæ±‡æ€»
     â””â”€ Agent C â”€â”˜
  â””â”€ ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«
  â””â”€ ç¼ºç‚¹ï¼šå„Agentç‹¬ç«‹,æ— åä½œ
  â””â”€ BettaFishé‡‡ç”¨ï¼šâš ï¸ ä»…åœ¨åˆæœŸä½¿ç”¨
```

**3. åä½œæ¨¡å¼ï¼ˆCollaborativeï¼‰**
```
å¹¶è¡Œå¯åŠ¨
  â”‚
  â”œâ”€ Agent A â”€â”
  â”œâ”€ Agent B â”€â”¼â†’ è®ºå›äº¤æµ â†’ Agentè¯»å– â†’ è°ƒæ•´ç­–ç•¥
  â””â”€ Agent C â”€â”˜     â†‘            â†“
                   â””â”€â”€â”€â”€å¾ªç¯è¿­ä»£â”€â”€â”€â”€â”˜
  â””â”€ ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ä¸”æœ‰ååŒ,ç»“æœè´¨é‡é«˜
  â””â”€ ç¼ºç‚¹ï¼šå®ç°å¤æ‚
  â””â”€ BettaFishé‡‡ç”¨ï¼šâœ… æ ¸å¿ƒæ¨¡å¼
```

#### BettaFishçš„æ··åˆåä½œæ¨¡å¼

```
ã€é˜¶æ®µ1ï¼šå¹¶è¡Œå¯åŠ¨ã€‘ï¼ˆ0-2åˆ†é’Ÿï¼‰
   ä¸‰ä¸ªAgentåŒæ—¶å¼€å§‹å·¥ä½œ,å„è‡ªè¿›è¡Œåˆæ­¥æœç´¢
         â†“
ã€é˜¶æ®µ2ï¼šè®ºå›åä½œã€‘ï¼ˆ2-10åˆ†é’Ÿ,å¤šè½®è¿­ä»£ï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  å¾ªç¯è¿­ä»£ï¼ˆ3-5è½®ï¼‰           â”‚
   â”‚                             â”‚
   â”‚  Agentå·¥ä½œ â†’ å†™æ—¥å¿—          â”‚
   â”‚     â†“                       â”‚
   â”‚  ForumEngineç›‘æ§ â†’ ç”Ÿæˆæ€»ç»“  â”‚
   â”‚     â†“                       â”‚
   â”‚  Agentè¯»å–è®ºå› â†’ è°ƒæ•´ç­–ç•¥    â”‚
   â”‚     â†“                       â”‚
   â”‚  æ·±åº¦ç ”ç©¶ â”€â”€â”€â”€â”˜              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
ã€é˜¶æ®µ3ï¼šç»“æœèåˆã€‘ï¼ˆ10-12åˆ†é’Ÿï¼‰
   ReportEngineæ”¶é›†æ‰€æœ‰ç»“æœ â†’ ç”ŸæˆæŠ¥å‘Š
```

### 2.4 å®Œæ•´åä½œæµç¨‹ï¼ˆ12æ­¥è¯¦è§£ï¼‰

| æ­¥éª¤ | é˜¶æ®µ | ä¸»è¦æ“ä½œ | æ¶‰åŠæ–‡ä»¶ | å…³é”®ä»£ç ä½ç½® |
|------|------|---------|---------|------------|
| **1** | ç”¨æˆ·æé—® | Flaskæ¥æ”¶Webè¯·æ±‚ | `app.py` | `@app.route('/')` |
| **2** | ä»»åŠ¡åˆ†å‘ | ä¸»åº”ç”¨å¹¶è¡Œå¯åŠ¨3ä¸ªAgent | `app.py` | `subprocess.Popen()` |
| **3** | åˆæ­¥æœç´¢ | å„Agentç”¨å·¥å…·æ¦‚è§ˆæ€§æœç´¢ | `*/agent.py` | `execute_search_tool()` |
| **4** | ç­–ç•¥åˆ¶å®š | åŸºäºåˆæ­¥ç»“æœåˆ¶å®šæ·±å…¥ç­–ç•¥ | `*/nodes/` | `ReportStructureNode` |
| **5** | è®ºå›å¯åŠ¨ | ForumEngineå¼€å§‹ç›‘æ§æ—¥å¿— | `ForumEngine/monitor.py` | `LogMonitor.start()` |
| **6** | æ·±åº¦ç ”ç©¶(R1) | Agentæ‰§è¡Œæ·±å…¥æœç´¢,è®°å½•å‘ç° | `*/nodes/search_node.py` | `FirstSearchNode.run()` |
| **7** | è®ºå›æ€»ç»“(R1) | ä¸»æŒäººLLMåˆ†æå‘è¨€,ç”Ÿæˆæ€»ç»“ | `ForumEngine/llm_host.py` | `generate_host_speech()` |
| **8** | äº¤æµèåˆ(R1) | Agentè¯»å–è®ºå›,è°ƒæ•´æ–¹å‘ | `utils/forum_reader.py` | `read_forum_summary()` |
| **9-N** | **å¾ªç¯è¿­ä»£** | é‡å¤6-8æ­¥,3-5è½® | - | **è¿­ä»£æœºåˆ¶** |
| **N+1** | ç»“æœæ”¶é›† | ReportEngineæ”¶é›†æ‰€æœ‰ç»“æœ | `ReportEngine/agent.py` | `collect_results()` |
| **N+2** | æ¨¡æ¿é€‰æ‹© | æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©æ¨¡æ¿ | `ReportEngine/nodes/` | `TemplateSelectionNode` |
| **N+3** | æŠ¥å‘Šç”Ÿæˆ | ç”ŸæˆHTMLæŠ¥å‘Š | `ReportEngine/nodes/` | `HtmlGenerationNode` |

---

## ğŸ™ï¸ ç¬¬ä¸‰é˜¶æ®µï¼šè®ºå›åä½œæœºåˆ¶æ·±åº¦è§£æï¼ˆâ­ æ ¸å¿ƒé‡ç‚¹ï¼‰

### 3.1 è®ºå›æœºåˆ¶çš„è®¾è®¡åŠ¨æœº

#### é—®é¢˜åœºæ™¯ï¼šå¦‚æœæ²¡æœ‰åä½œä¼šæ€æ ·ï¼Ÿ

**åœºæ™¯1ï¼šé‡å¤åŠ³åŠ¨**
```
QueryEngine:  æˆ‘æœç´¢äº†"æ­¦æ±‰å¤§å­¦æ’å"ï¼Œå‘ç°æ’åä¸Šå‡
InsightEngine: æˆ‘ä¹Ÿåœ¨æ•°æ®åº“æŸ¥è¯¢äº†"æ­¦æ±‰å¤§å­¦æ’å"...
              âŒ é‡å¤å·¥ä½œï¼Œæµªè´¹èµ„æºï¼
```

**åœºæ™¯2ï¼šä¿¡æ¯å­¤å²›**
```
MediaEngine:   æˆ‘å‘ç°è§†é¢‘é‡Œ"æ¨±èŠ±å­£"æ˜¯çƒ­ç‚¹
QueryEngine:   ï¼ˆä¸çŸ¥é“è¿™ä¸ªå‘ç°ï¼‰ç»§ç»­æœç´¢å…¶ä»–å…³é”®è¯
               âŒ é”™å¤±å…³é”®çº¿ç´¢ï¼Œåˆ†æä¸æ·±å…¥ï¼
```

**åœºæ™¯3ï¼šç¼ºä¹æ•´ä½“è§†è§’**
```
å„Agentç‹¬ç«‹å·¥ä½œï¼Œåƒ"ç›²äººæ‘¸è±¡"
Queryçœ‹åˆ°ç½‘ç»œçƒ­åº¦ï¼ŒMediaçœ‹åˆ°è§†é¢‘å†…å®¹ï¼ŒInsightçœ‹åˆ°å†å²æ•°æ®
ä½†æ²¡æœ‰äººæŠŠä¸‰è€…è”ç³»èµ·æ¥
âŒ åˆ†æç‰‡é¢ï¼Œç¼ºä¹ç»¼åˆè§†è§’ï¼
```

#### è§£å†³æ–¹æ¡ˆï¼šè®ºå›åä½œæœºåˆ¶

**æ ¸å¿ƒæ€æƒ³**ï¼šæ¨¡æ‹Ÿäººç±»å›¢é˜Ÿå¼€ä¼šè®¨è®º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      äººç±»å›¢é˜Ÿä¼šè®®  vs  Agentè®ºå›        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æˆå‘˜å‘è¨€è‡ªå·±çš„å‘ç°                   â”‚
â”‚    â†’ Agentå†™æ—¥å¿—è®°å½•å‘ç°                â”‚
â”‚                                        â”‚
â”‚ 2. ä¸»æŒäººæ€»ç»“è¦ç‚¹                       â”‚
â”‚    â†’ ForumEngineç”Ÿæˆæ€»ç»“                â”‚
â”‚                                        â”‚
â”‚ 3. æˆå‘˜å¬å–ä»–äººè§‚ç‚¹                     â”‚
â”‚    â†’ Agentè¯»å–è®ºå›å†…å®¹                  â”‚
â”‚                                        â”‚
â”‚ 4. è°ƒæ•´ä¸‹ä¸€æ­¥è®¡åˆ’                       â”‚
â”‚    â†’ Agentè°ƒæ•´ç ”ç©¶ç­–ç•¥                  â”‚
â”‚                                        â”‚
â”‚ 5. å¤šè½®è®¨è®ºæ·±åŒ–                         â”‚
â”‚    â†’ è¿­ä»£3-5è½®ä¼˜åŒ–                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è®ºå›æœºåˆ¶çš„æŠ€æœ¯å®ç°

#### æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è®ºå›åä½œæœºåˆ¶æŠ€æœ¯æ¶æ„                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å±‚çº§1ï¼šå‘è¨€å±‚ã€‘Agentæ—¥å¿—æ–‡ä»¶
â”œâ”€ logs/query.log       â† QueryEngineçš„å·¥ä½œæ—¥å¿—
â”œâ”€ logs/media.log       â† MediaEngineçš„å·¥ä½œæ—¥å¿—
â””â”€ logs/insight.log     â† InsightEngineçš„å·¥ä½œæ—¥å¿—

      æ¯ä¸ªAgentåœ¨å…³é”®å‘ç°æ—¶å†™å…¥ï¼š
      logger.info("ã€è®ºå›å‘è¨€ã€‘æˆ‘å‘ç°äº†...")
            â†“
ã€å±‚çº§2ï¼šç›‘æ§å±‚ã€‘ForumEngineå®æ—¶ç›‘æ§
â”œâ”€ ForumEngine/monitor.py
â”‚     â”œâ”€ LogMonitorç±»
â”‚     â”‚    â”œâ”€ æ¯5ç§’æ‰«æä¸€æ¬¡æ—¥å¿—æ–‡ä»¶
â”‚     â”‚    â”œâ”€ è®°å½•æ¯ä¸ªæ–‡ä»¶çš„è¯»å–ä½ç½®ï¼ˆfile_positionsï¼‰
â”‚     â”‚    â””â”€ æå–åŒ…å«"SummaryNode"çš„å†…å®¹
â”‚     â”‚
â”‚     â””â”€ æå–åˆ°æ–°å‘è¨€å â†’
            â†“
ã€å±‚çº§3ï¼šåˆ†æå±‚ã€‘ä¸»æŒäººLLMåˆ†æ
â”œâ”€ ForumEngine/llm_host.py
â”‚     â”œâ”€ generate_host_speech()å‡½æ•°
â”‚     â”‚    â”œâ”€ æ¥æ”¶æ‰€æœ‰Agentçš„å‘è¨€
â”‚     â”‚    â”œâ”€ è°ƒç”¨LLMï¼ˆQwen3-235Bï¼‰åˆ†æ
â”‚     â”‚    â””â”€ ç”Ÿæˆå¼•å¯¼æ€§æ€»ç»“
â”‚     â”‚
â”‚     â””â”€ è¾“å‡ºæ ¼å¼ï¼š
â”‚         ã€é‡è¦å‘ç°ã€‘...
â”‚         ã€å…³è”åˆ†æã€‘...
â”‚         ã€ç ”ç©¶å»ºè®®ã€‘...
            â†“
ã€å±‚çº§4ï¼šå…±äº«å±‚ã€‘è®ºå›æ€»ç»“æ–‡ä»¶
â”œâ”€ logs/forum.log
â”‚     â””â”€ å­˜å‚¨ä¸»æŒäººçš„æ€»ç»“
â”‚     â””â”€ åŒ…å«æ—¶é—´æˆ³ã€å‘è¨€æ¥æºã€æ€»ç»“å†…å®¹
            â†“
ã€å±‚çº§5ï¼šè¯»å–å±‚ã€‘Agentè¯»å–è®ºå›
â”œâ”€ utils/forum_reader.py
â”‚     â””â”€ read_forum_summary()å‡½æ•°
â”‚          â””â”€ å„Agentè°ƒç”¨æ­¤å‡½æ•°è·å–è®ºå›å†…å®¹
            â†“
ã€å±‚çº§6ï¼šåé¦ˆå±‚ã€‘Agentè°ƒæ•´ç­–ç•¥
â””â”€ å„Agentå°†è®ºå›å†…å®¹åŠ å…¥LLMä¸Šä¸‹æ–‡
   â””â”€ æ ¹æ®è®ºå›å»ºè®®è°ƒæ•´ä¸‹ä¸€è½®æœç´¢æ–¹å‘
```

### 3.3 ä»£ç é€è¡Œå‰–æï¼š`ForumEngine/monitor.py`

#### æ ¸å¿ƒç±»ï¼šLogMonitor

**ä½œç”¨**ï¼šå®æ—¶ç›‘æ§ä¸‰ä¸ªAgentçš„æ—¥å¿—æ–‡ä»¶ï¼Œæå–é‡è¦å‘è¨€

```python
# æ–‡ä»¶ï¼šForumEngine/monitor.pyï¼ˆç®€åŒ–ç‰ˆï¼‰

class LogMonitor:
    """åŸºäºæ–‡ä»¶å˜åŒ–çš„æ™ºèƒ½æ—¥å¿—ç›‘æ§å™¨"""

    def __init__(self, log_dir: str = "logs"):
        """åˆå§‹åŒ–ç›‘æ§å™¨"""
        self.log_dir = Path(log_dir)
        self.forum_log_file = self.log_dir / "forum.log"  # è®ºå›æ€»ç»“æ–‡ä»¶

        # è¦ç›‘æ§çš„ä¸‰ä¸ªAgentæ—¥å¿—
        self.monitored_logs = {
            'insight': self.log_dir / 'insight.log',
            'media': self.log_dir / 'media.log',
            'query': self.log_dir / 'query.log'
        }

        # ç›‘æ§çŠ¶æ€
        self.file_positions = {}        # è®°å½•æ¯ä¸ªæ–‡ä»¶çš„è¯»å–ä½ç½®
        self.agent_speeches_buffer = [] # Agentå‘è¨€ç¼“å†²åŒº
        self.host_speech_threshold = 5  # æ¯5æ¡å‘è¨€è§¦å‘ä¸€æ¬¡ä¸»æŒäºº

        # ç›®æ ‡èŠ‚ç‚¹è¯†åˆ«æ¨¡å¼ï¼ˆå…³é”®ï¼ï¼‰
        self.target_node_patterns = [
            'FirstSummaryNode',       # é¦–æ¬¡æ€»ç»“èŠ‚ç‚¹
            'ReflectionSummaryNode',  # åæ€æ€»ç»“èŠ‚ç‚¹
            'nodes.summary_node',     # æ¨¡å—è·¯å¾„
            'æ­£åœ¨ç”Ÿæˆé¦–æ¬¡æ®µè½æ€»ç»“',   # æ ‡è¯†æ–‡æœ¬
            'æ­£åœ¨ç”Ÿæˆåæ€æ€»ç»“',
        ]
```

**å…³é”®ç‚¹1ï¼šä¸ºä»€ä¹ˆç›‘æ§SummaryNodeï¼Ÿ**
```
å› ä¸ºSummaryNodeæ˜¯Agentå¯¹æœç´¢ç»“æœçš„æ€»ç»“ï¼Œ
ä»£è¡¨äº†Agentçš„"æ ¸å¿ƒå‘ç°"ï¼Œæœ€æœ‰ä»·å€¼ï¼

Agentå·¥ä½œæµç¨‹ï¼š
SearchNode â†’ æ‰§è¡Œæœç´¢ â†’ è·å¾—å¤§é‡åŸå§‹æ•°æ®
     â†“
SummaryNode â†’ æ€»ç»“å…³é”®ä¿¡æ¯ â† ğŸ¯ è¿™é‡Œæ˜¯é‡ç‚¹ï¼
     â†“
å†™å…¥æ—¥å¿— â†’ ForumEngineç›‘æ§åˆ°
```

#### æ ¸å¿ƒæ–¹æ³•1ï¼šstart_monitoring()

**ä½œç”¨**ï¼šå¯åŠ¨ç›‘æ§çº¿ç¨‹ï¼ŒæŒç»­æ‰«ææ—¥å¿—

```python
def start_monitoring(self):
    """å¯åŠ¨ç›‘æ§ï¼ˆåœ¨åå°çº¿ç¨‹è¿è¡Œï¼‰"""
    if self.is_monitoring:
        logger.warning("ForumEngine: ç›‘æ§å·²åœ¨è¿è¡Œ")
        return

    self.is_monitoring = True
    self.clear_forum_log()  # æ¸…ç©ºæ—§çš„è®ºå›æ—¥å¿—

    # åˆ›å»ºåå°çº¿ç¨‹è¿è¡Œç›‘æ§
    self.monitor_thread = threading.Thread(
        target=self._monitor_loop,
        daemon=True
    )
    self.monitor_thread.start()
    logger.info("ForumEngine: ç›‘æ§å·²å¯åŠ¨")
```

**å…³é”®ç‚¹2ï¼šä¸ºä»€ä¹ˆç”¨åå°çº¿ç¨‹ï¼Ÿ**
```
å› ä¸ºç›‘æ§æ˜¯æŒç»­æ€§å·¥ä½œï¼Œä¸èƒ½é˜»å¡ä¸»ç¨‹åºï¼

ä¸»ç¨‹åºæµç¨‹ï¼š
app.pyå¯åŠ¨ â†’ å¯åŠ¨ForumEngineç›‘æ§ â†’ å¯åŠ¨3ä¸ªAgent
                    â†“ï¼ˆåå°è¿è¡Œï¼‰
          ForumEngineæŒç»­ç›‘æ§æ—¥å¿—
                    â†“
          å‘ç°æ–°å‘è¨€ â†’ ç”Ÿæˆæ€»ç»“ â†’ å†™å…¥forum.log
```

#### æ ¸å¿ƒæ–¹æ³•2ï¼š_monitor_loop()

**ä½œç”¨**ï¼šç›‘æ§ä¸»å¾ªç¯ï¼Œæ¯5ç§’æ‰«æä¸€æ¬¡

```python
def _monitor_loop(self):
    """ç›‘æ§ä¸»å¾ªç¯ï¼ˆåœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œï¼‰"""
    while self.is_monitoring:
        try:
            # æ£€æŸ¥æ¯ä¸ªAgentçš„æ—¥å¿—æ–‡ä»¶
            for app_name, log_file in self.monitored_logs.items():
                if not log_file.exists():
                    continue

                # è¯»å–æ–°å¢å†…å®¹
                new_content = self._read_new_content(app_name, log_file)

                if new_content:
                    # æ£€æŸ¥æ˜¯å¦åŒ…å«ç›®æ ‡èŠ‚ç‚¹ï¼ˆSummaryNodeï¼‰
                    if self._contains_target_node(new_content):
                        # æå–å‘è¨€å†…å®¹
                        speech = self._extract_speech(app_name, new_content)

                        # æ·»åŠ åˆ°ç¼“å†²åŒº
                        self.agent_speeches_buffer.append(speech)

                        # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼ˆ5æ¡å‘è¨€ï¼‰
                        if len(self.agent_speeches_buffer) >= self.host_speech_threshold:
                            # è°ƒç”¨ä¸»æŒäººLLMç”Ÿæˆæ€»ç»“
                            self._generate_and_write_host_speech()
                            # æ¸…ç©ºç¼“å†²åŒº
                            self.agent_speeches_buffer = []

            # ç­‰å¾…5ç§’å†æ¬¡æ‰«æ
            time.sleep(5)

        except Exception as e:
            logger.error(f"ForumEngineç›‘æ§å¼‚å¸¸: {e}")
            time.sleep(5)
```

**æµç¨‹å›¾è§£**ï¼š
```
ã€æ—¶é—´è½´ç¤ºæ„ã€‘

T=0s   ç›‘æ§å¯åŠ¨
         â†“
T=5s   ç¬¬1æ¬¡æ‰«æ
         â”œâ”€ è¯»å–insight.logæ–°å†…å®¹
         â”œâ”€ è¯»å–media.logæ–°å†…å®¹
         â””â”€ è¯»å–query.logæ–°å†…å®¹
         â””â”€ æœªå‘ç°SummaryNode â†’ æ— æ“ä½œ
         â†“
T=10s  ç¬¬2æ¬¡æ‰«æ
         â”œâ”€ insight.logæœ‰æ–°å†…å®¹
         â”‚    â””â”€ å‘ç°"FirstSummaryNode"
         â”‚         â””â”€ æå–å‘è¨€ â†’ åŠ å…¥buffer[1/5]
         â””â”€ å…¶ä»–æ— å˜åŒ–
         â†“
T=15s  ç¬¬3æ¬¡æ‰«æ
         â”œâ”€ query.logæœ‰æ–°å†…å®¹
         â”‚    â””â”€ å‘ç°"FirstSummaryNode"
         â”‚         â””â”€ æå–å‘è¨€ â†’ åŠ å…¥buffer[2/5]
         â†“
         ...ï¼ˆç»§ç»­æ‰«æï¼‰...
         â†“
T=35s  ç¬¬7æ¬¡æ‰«æ
         â”œâ”€ media.logæœ‰æ–°å†…å®¹
         â”‚    â””â”€ å‘ç°"ReflectionSummaryNode"
         â”‚         â””â”€ æå–å‘è¨€ â†’ åŠ å…¥buffer[5/5]
         â”‚
         â””â”€ bufferæ»¡5æ¡ï¼è§¦å‘ä¸»æŒäººLLM
              â”œâ”€ è°ƒç”¨generate_host_speech()
              â”œâ”€ LLMåˆ†æ5æ¡å‘è¨€
              â”œâ”€ ç”Ÿæˆæ€»ç»“
              â””â”€ å†™å…¥forum.log
              â””â”€ æ¸…ç©ºbuffer
```

#### æ ¸å¿ƒæ–¹æ³•3ï¼š_read_new_content()

**ä½œç”¨**ï¼šåªè¯»å–æ–‡ä»¶çš„æ–°å¢å†…å®¹ï¼ˆé¿å…é‡å¤è¯»å–ï¼‰

```python
def _read_new_content(self, app_name: str, log_file: Path) -> str:
    """è¯»å–æ–‡ä»¶çš„æ–°å¢å†…å®¹"""
    # è·å–ä¸Šæ¬¡è¯»å–çš„ä½ç½®
    last_position = self.file_positions.get(app_name, 0)

    with open(log_file, 'r', encoding='utf-8', errors='ignore') as f:
        # è·³åˆ°ä¸Šæ¬¡è¯»å–çš„ä½ç½®
        f.seek(last_position)

        # è¯»å–æ–°å†…å®¹
        new_content = f.read()

        # æ›´æ–°è¯»å–ä½ç½®
        current_position = f.tell()
        self.file_positions[app_name] = current_position

    return new_content
```

**å…³é”®ç‚¹3ï¼šä¸ºä»€ä¹ˆè¦è®°å½•è¯»å–ä½ç½®ï¼Ÿ**
```
å¦‚æœä¸è®°å½•ä½ç½®ï¼Œæ¯æ¬¡éƒ½ä»å¤´è¯»å–ï¼š
  ç¬¬1æ¬¡æ‰«æï¼šè¯»å–100è¡Œ
  ç¬¬2æ¬¡æ‰«æï¼šåˆè¯»å–è¿™100è¡Œ + æ–°å¢10è¡Œ
  ç¬¬3æ¬¡æ‰«æï¼šåˆè¯»å–è¿™110è¡Œ + æ–°å¢5è¡Œ
  â†’ âŒ é‡å¤å¤„ç†ï¼Œæµªè´¹èµ„æºï¼Œå¯èƒ½é‡å¤è§¦å‘ä¸»æŒäººï¼

ä½¿ç”¨file_positionsè®°å½•ï¼š
  ç¬¬1æ¬¡æ‰«æï¼šè¯»å–100è¡Œï¼Œè®°å½•ä½ç½®=100
  ç¬¬2æ¬¡æ‰«æï¼šä»ä½ç½®100å¼€å§‹ï¼Œåªè¯»å–æ–°å¢10è¡Œï¼Œè®°å½•ä½ç½®=110
  ç¬¬3æ¬¡æ‰«æï¼šä»ä½ç½®110å¼€å§‹ï¼Œåªè¯»å–æ–°å¢5è¡Œï¼Œè®°å½•ä½ç½®=115
  â†’ âœ… åªå¤„ç†æ–°å†…å®¹ï¼Œé«˜æ•ˆå‡†ç¡®ï¼
```

#### æ ¸å¿ƒæ–¹æ³•4ï¼š_contains_target_node()

**ä½œç”¨**ï¼šåˆ¤æ–­æ—¥å¿—å†…å®¹æ˜¯å¦åŒ…å«ç›®æ ‡èŠ‚ç‚¹ï¼ˆSummaryNodeï¼‰

```python
def _contains_target_node(self, content: str) -> bool:
    """æ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«ç›®æ ‡èŠ‚ç‚¹"""
    for pattern in self.target_node_patterns:
        if pattern in content:
            return True
    return False
```

**target_node_patterns è¯¦è§£**ï¼š
```python
self.target_node_patterns = [
    # æ–¹å¼1ï¼šç±»ååŒ¹é…
    'FirstSummaryNode',       # é¦–æ¬¡æ€»ç»“èŠ‚ç‚¹
    'ReflectionSummaryNode',  # åæ€æ€»ç»“èŠ‚ç‚¹

    # æ–¹å¼2ï¼šæ¨¡å—è·¯å¾„åŒ¹é…
    'InsightEngine.nodes.summary_node',
    'MediaEngine.nodes.summary_node',
    'QueryEngine.nodes.summary_node',
    'nodes.summary_node',  # éƒ¨åˆ†è·¯å¾„ï¼ˆå…¼å®¹æ€§ï¼‰

    # æ–¹å¼3ï¼šæ ‡è¯†æ–‡æœ¬åŒ¹é…
    'æ­£åœ¨ç”Ÿæˆé¦–æ¬¡æ®µè½æ€»ç»“',
    'æ­£åœ¨ç”Ÿæˆåæ€æ€»ç»“',
]

# Agentæ—¥å¿—ç¤ºä¾‹ï¼š
# 2025-01-15 10:30:45 | INFO | InsightEngine.nodes.summary_node:run:42 - æ­£åœ¨ç”Ÿæˆé¦–æ¬¡æ®µè½æ€»ç»“...
#                                  â†‘åŒ¹é…æˆåŠŸâ†‘                              â†‘åŒ¹é…æˆåŠŸâ†‘
```

### 3.4 ä»£ç å‰–æï¼š`ForumEngine/llm_host.py`

#### ä¸»æŒäººLLMçš„ä½œç”¨

**æ ¸å¿ƒå‡½æ•°ï¼šgenerate_host_speech()**

```python
# æ–‡ä»¶ï¼šForumEngine/llm_host.pyï¼ˆç®€åŒ–ç‰ˆï¼‰

from openai import OpenAI
from config import settings

def generate_host_speech(agent_speeches: List[str]) -> str:
    """
    ä¸»æŒäººLLMåˆ†æAgentå‘è¨€ï¼Œç”Ÿæˆå¼•å¯¼æ€§æ€»ç»“

    Args:
        agent_speeches: Agentå‘è¨€åˆ—è¡¨
                        ä¾‹å¦‚ï¼š["QueryEngine: æˆ‘å‘ç°...", "MediaEngine: æˆ‘å‘ç°..."]

    Returns:
        ä¸»æŒäººæ€»ç»“æ–‡æœ¬
    """
    # åˆå§‹åŒ–LLMå®¢æˆ·ç«¯ï¼ˆä½¿ç”¨Qwen3-235Bï¼‰
    client = OpenAI(
        api_key=settings.FORUM_HOST_API_KEY,
        base_url=settings.FORUM_HOST_BASE_URL
    )

    # æ„å»ºPrompt
    prompt = f"""
ä½ æ˜¯ä¸€ä¸ªèˆ†æƒ…åˆ†æå›¢é˜Ÿçš„ä¸»æŒäººã€‚ä»¥ä¸‹æ˜¯å„ä¸ªç ”ç©¶å‘˜æœ€è¿‘çš„å‘ç°ï¼š

{chr(10).join(agent_speeches)}

è¯·ä½ ä½œä¸ºä¸»æŒäººï¼š
1. æ€»ç»“å„ç ”ç©¶å‘˜çš„é‡è¦å‘ç°
2. åˆ†æè¿™äº›å‘ç°ä¹‹é—´çš„å…³è”
3. æŒ‡å‡ºè¿˜æœ‰å“ªäº›æ–¹å‘å€¼å¾—æ·±å…¥ç ”ç©¶
4. ç»™å‡ºä¸‹ä¸€æ­¥å»ºè®®

è¾“å‡ºæ ¼å¼ï¼š
ã€é‡è¦å‘ç°ã€‘
...

ã€å…³è”åˆ†æã€‘
...

ã€ç ”ç©¶å»ºè®®ã€‘
...
"""

    # è°ƒç”¨LLM
    response = client.chat.completions.create(
        model=settings.FORUM_HOST_MODEL_NAME,  # Qwen3-235B
        messages=[{"role": "user", "content": prompt}],
        temperature=0.7
    )

    return response.choices[0].message.content
```

#### ä¸»æŒäººPromptè®¾è®¡è§£æ

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡Promptï¼Ÿ**

```
ã€è®¾è®¡åŸåˆ™1ã€‘æ˜ç¡®è§’è‰²å®šä½
   "ä½ æ˜¯ä¸€ä¸ªèˆ†æƒ…åˆ†æå›¢é˜Ÿçš„ä¸»æŒäºº"
   â†’ è®©LLMç†è§£è‡ªå·±æ˜¯åè°ƒè€…ï¼Œä¸æ˜¯æ‰§è¡Œè€…

ã€è®¾è®¡åŸåˆ™2ã€‘æä¾›ä¸Šä¸‹æ–‡
   "ä»¥ä¸‹æ˜¯å„ä¸ªç ”ç©¶å‘˜æœ€è¿‘çš„å‘ç°ï¼š..."
   â†’ ç»™å‡ºæ‰€æœ‰Agentçš„å‘è¨€ï¼Œè®©ä¸»æŒäººæœ‰å…¨å±€è§†è§’

ã€è®¾è®¡åŸåˆ™3ã€‘æ˜ç¡®ä»»åŠ¡
   "æ€»ç»“ã€åˆ†æã€æŒ‡å‡ºã€ç»™å‡ºå»ºè®®"
   â†’ 4ä¸ªæ˜ç¡®çš„ä»»åŠ¡ï¼Œé¿å…LLMå‘æ•£

ã€è®¾è®¡åŸåˆ™4ã€‘ç»“æ„åŒ–è¾“å‡º
   "ã€é‡è¦å‘ç°ã€‘ã€å…³è”åˆ†æã€‘ã€ç ”ç©¶å»ºè®®ã€‘"
   â†’ å¼ºåˆ¶ç»“æ„åŒ–ï¼Œæ–¹ä¾¿Agentè§£æ
```

#### ä¸»æŒäººLLMçš„è¾“å‡ºç¤ºä¾‹

```markdown
ã€é‡è¦å‘ç°ã€‘
1. QueryEngineåœ¨å¾®åšå‘ç°"æ¨±èŠ±å­£"æˆä¸ºè¿‘æœŸçƒ­ç‚¹è¯é¢˜
2. MediaEngineåˆ†æäº†å¤§é‡çŸ­è§†é¢‘ï¼Œå‘ç°"æ­¦å¤§æ¨±èŠ±"ç›¸å…³å†…å®¹æ¿€å¢
3. InsightEngineæŸ¥è¯¢æ•°æ®åº“ï¼Œå‘ç°"æ¨±èŠ±å­£"ç›¸å…³è®¨è®ºé‡åŒæ¯”å¢é•¿300%

ã€å…³è”åˆ†æã€‘
ä¸‰ä¸ªç ”ç©¶å‘˜çš„å‘ç°é«˜åº¦ä¸€è‡´ï¼Œå…±åŒæŒ‡å‘"æ¨±èŠ±å­£"æ˜¯æ­¦æ±‰å¤§å­¦è¿‘æœŸæœ€æ ¸å¿ƒçš„èˆ†æƒ…è¯é¢˜ã€‚
ç½‘ç»œçƒ­åº¦ï¼ˆQueryEngineï¼‰ã€å¤šåª’ä½“å†…å®¹ï¼ˆMediaEngineï¼‰ã€å†å²æ•°æ®å¯¹æ¯”ï¼ˆInsightEngineï¼‰
ä¸‰æ–¹é¢è¯æ®ç›¸äº’å°è¯ï¼Œè¯´æ˜è¿™æ˜¯çœŸå®ä¸”æ˜¾è‘—çš„èˆ†æƒ…ç°è±¡ã€‚

ã€ç ”ç©¶å»ºè®®ã€‘
1. å»ºè®®InsightEngineæŒ‰æ—¶é—´è½´æ·±å…¥åˆ†ææ¨±èŠ±å­£æœŸé—´çš„èˆ†æƒ…å˜åŒ–è¶‹åŠ¿
2. å»ºè®®MediaEngineé‡ç‚¹åˆ†ææ¨±èŠ±ç›¸å…³è§†é¢‘çš„æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢/è´Ÿé¢ï¼‰
3. å»ºè®®QueryEngineæœç´¢æ˜¯å¦æœ‰ä¸æ¨±èŠ±å­£ç›¸å…³çš„è´Ÿé¢äº‹ä»¶æˆ–äº‰è®®
```

### 3.5 ä»£ç å‰–æï¼š`utils/forum_reader.py`

#### Agentå¦‚ä½•è¯»å–è®ºå›å†…å®¹ï¼Ÿ

```python
# æ–‡ä»¶ï¼šutils/forum_reader.pyï¼ˆç®€åŒ–ç‰ˆï¼‰

from pathlib import Path

def read_forum_summary() -> str:
    """
    è¯»å–æœ€æ–°çš„è®ºå›æ€»ç»“

    Returns:
        è®ºå›æ€»ç»“æ–‡æœ¬ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²
    """
    forum_log_file = Path("logs/forum.log")

    try:
        with open(forum_log_file, "r", encoding="utf-8") as f:
            content = f.read()
        return content
    except FileNotFoundError:
        return "æš‚æ— è®ºå›è®¨è®º"
```

#### Agentå¦‚ä½•ä½¿ç”¨è®ºå›å†…å®¹ï¼Ÿ

```python
# æ–‡ä»¶ï¼šInsightEngine/nodes/search_node.pyï¼ˆç¤ºä¾‹ï¼‰

from utils.forum_reader import read_forum_summary

class FirstSearchNode:
    def run(self, state):
        # è¯»å–è®ºå›å†…å®¹
        forum_content = read_forum_summary()

        # æ„å»ºåŒ…å«è®ºå›å†…å®¹çš„Prompt
        prompt = f"""
ä½ çš„ä»»åŠ¡ï¼š{state.user_query}

å›¢é˜Ÿè®ºå›æœ€æ–°è®¨è®ºï¼š
{forum_content}

åŸºäºè®ºå›ä¸­å…¶ä»–ç ”ç©¶å‘˜çš„å‘ç°ï¼Œè¯·ä½ ï¼š
1. é¿å…é‡å¤ä»–ä»¬å·²ç»æœç´¢è¿‡çš„å†…å®¹
2. æ·±å…¥æŒ–æ˜ä»–ä»¬æåˆ°çš„å…³é”®è¯é¢˜
3. è¡¥å……ä»–ä»¬é—æ¼çš„è§’åº¦

ç°åœ¨å¼€å§‹ä½ çš„ç ”ç©¶...
"""

        # è°ƒç”¨LLMæ‰§è¡Œæœç´¢
        response = self.llm_client.generate(prompt)
        ...
```

**æ•ˆæœç¤ºä¾‹**ï¼š
```
ã€æ²¡æœ‰è®ºå›æœºåˆ¶æ—¶ã€‘
InsightEngine: æˆ‘æœç´¢"æ­¦æ±‰å¤§å­¦"ï¼Œæ‰¾åˆ°1000æ¡æ•°æ®
               ï¼ˆä¸çŸ¥é“æ¨±èŠ±å­£æ˜¯é‡ç‚¹ï¼‰

ã€æœ‰è®ºå›æœºåˆ¶åã€‘
InsightEngineè¯»å–è®ºå›ï¼š
  "QueryEngineå‘ç°æ¨±èŠ±å­£æ˜¯çƒ­ç‚¹"
  "MediaEngineå‘ç°å¤§é‡æ¨±èŠ±è§†é¢‘"
InsightEngineè°ƒæ•´ç­–ç•¥ï¼š
  é‡ç‚¹æœç´¢"æ­¦æ±‰å¤§å­¦ æ¨±èŠ±å­£"ç›¸å…³æ•°æ®
  å¹¶æŒ‰æ—¶é—´è½´åˆ†æè¶‹åŠ¿
  â†’ âœ… åˆ†ææ›´æœ‰é’ˆå¯¹æ€§ï¼Œè´¨é‡æ›´é«˜ï¼
```

### 3.6 å®Œæ•´çš„ä¸€è½®è®ºå›åä½œæµç¨‹

#### æ—¶é—´è½´ç¤ºæ„

```
ã€T=0åˆ†é’Ÿã€‘ç³»ç»Ÿå¯åŠ¨
â”œâ”€ app.pyå¯åŠ¨Flaskåº”ç”¨
â”œâ”€ å¯åŠ¨ForumEngineç›‘æ§ï¼ˆåå°çº¿ç¨‹ï¼‰
â””â”€ å¹¶è¡Œå¯åŠ¨3ä¸ªAgent

ã€T=1åˆ†é’Ÿã€‘å„Agentå¼€å§‹å·¥ä½œ
â”œâ”€ QueryEngine: æ‰§è¡ŒSearchNode,æœç´¢"æ­¦æ±‰å¤§å­¦"
â”œâ”€ MediaEngine: æ‰§è¡ŒSearchNode,æœç´¢ç›¸å…³è§†é¢‘
â””â”€ InsightEngine: æ‰§è¡ŒSearchNode,æŸ¥è¯¢æ•°æ®åº“

ã€T=2åˆ†é’Ÿã€‘QueryEngineé¦–æ¬¡æ€»ç»“
â”œâ”€ æ‰§è¡ŒFirstSummaryNode
â”œâ”€ å†™å…¥æ—¥å¿—:
â”‚   "INFO | QueryEngine.nodes.summary_node - æ­£åœ¨ç”Ÿæˆé¦–æ¬¡æ®µè½æ€»ç»“"
â”‚   "ã€æ€»ç»“ã€‘æˆ‘å‘ç°å¾®åšçƒ­æœä¸­'æ¨±èŠ±å­£'æ˜¯çƒ­ç‚¹"
â””â”€ ForumEngineç›‘æ§åˆ° â†’ æå–å‘è¨€ â†’ buffer[1/5]

ã€T=3åˆ†é’Ÿã€‘MediaEngineé¦–æ¬¡æ€»ç»“
â”œâ”€ æ‰§è¡ŒFirstSummaryNode
â”œâ”€ å†™å…¥æ—¥å¿—:
â”‚   "ã€æ€»ç»“ã€‘çŸ­è§†é¢‘å¹³å°å¤§é‡'æ­¦å¤§æ¨±èŠ±'ç›¸å…³å†…å®¹"
â””â”€ ForumEngineç›‘æ§åˆ° â†’ æå–å‘è¨€ â†’ buffer[2/5]

ã€T=4åˆ†é’Ÿã€‘InsightEngineé¦–æ¬¡æ€»ç»“
â”œâ”€ æ‰§è¡ŒFirstSummaryNode
â”œâ”€ å†™å…¥æ—¥å¿—:
â”‚   "ã€æ€»ç»“ã€‘æ•°æ®åº“æ˜¾ç¤º'æ¨±èŠ±å­£'è®¨è®ºé‡åŒæ¯”å¢é•¿300%"
â””â”€ ForumEngineç›‘æ§åˆ° â†’ æå–å‘è¨€ â†’ buffer[3/5]

ã€T=5åˆ†é’Ÿã€‘QueryEngineåæ€æ€»ç»“
â”œâ”€ æ‰§è¡ŒReflectionSummaryNodeï¼ˆç¬¬1è½®åæ€ï¼‰
â”œâ”€ å†™å…¥æ—¥å¿—:
â”‚   "ã€åæ€ã€‘å‘ç°æ¨±èŠ±å­£æœŸé—´æœ‰é¢„çº¦åˆ¶åº¦ç›¸å…³è®¨è®º"
â””â”€ ForumEngineç›‘æ§åˆ° â†’ æå–å‘è¨€ â†’ buffer[4/5]

ã€T=6åˆ†é’Ÿã€‘MediaEngineåæ€æ€»ç»“
â”œâ”€ æ‰§è¡ŒReflectionSummaryNode
â”œâ”€ å†™å…¥æ—¥å¿—:
â”‚   "ã€åæ€ã€‘è§†é¢‘è¯„è®ºä¸­æœ‰å¯¹é¢„çº¦åˆ¶åº¦çš„æŠ±æ€¨"
â””â”€ ForumEngineç›‘æ§åˆ° â†’ æå–å‘è¨€ â†’ buffer[5/5]

ã€T=6åˆ†30ç§’ã€‘è§¦å‘ä¸»æŒäººLLMï¼
â”œâ”€ bufferå·²æ»¡5æ¡
â”œâ”€ è°ƒç”¨generate_host_speech()
â”œâ”€ LLMåˆ†æ5æ¡å‘è¨€
â”œâ”€ ç”Ÿæˆæ€»ç»“:
â”‚   ã€é‡è¦å‘ç°ã€‘æ¨±èŠ±å­£æ˜¯æ ¸å¿ƒè¯é¢˜
â”‚   ã€å…³è”åˆ†æã€‘é¢„çº¦åˆ¶åº¦å¼•å‘äº‰è®®
â”‚   ã€ç ”ç©¶å»ºè®®ã€‘æ·±å…¥åˆ†æé¢„çº¦åˆ¶åº¦èˆ†æƒ…
â””â”€ å†™å…¥logs/forum.log

ã€T=7åˆ†é’Ÿã€‘å„Agentè¯»å–è®ºå›
â”œâ”€ InsightEngineè°ƒç”¨read_forum_summary()
â”‚   â””â”€ å‘ç°ï¼š"æ·±å…¥åˆ†æé¢„çº¦åˆ¶åº¦èˆ†æƒ…"
â”‚   â””â”€ è°ƒæ•´ç­–ç•¥ï¼šé‡ç‚¹æœç´¢"é¢„çº¦åˆ¶åº¦"ç›¸å…³è¯„è®º
â”œâ”€ QueryEngineè¯»å–è®ºå›
â”‚   â””â”€ è°ƒæ•´ç­–ç•¥ï¼šæœç´¢"æ¨±èŠ±é¢„çº¦"ç›¸å…³æ–°é—»
â””â”€ MediaEngineè¯»å–è®ºå›
    â””â”€ è°ƒæ•´ç­–ç•¥ï¼šåˆ†æé¢„çº¦ç›¸å…³è§†é¢‘

ã€T=8-12åˆ†é’Ÿã€‘ç¬¬2è½®æ·±åº¦ç ”ç©¶
â””â”€ å„AgentåŸºäºè®ºå›å»ºè®®è¿›è¡Œé’ˆå¯¹æ€§ç ”ç©¶
    â””â”€ å†æ¬¡è§¦å‘æ€»ç»“ â†’ å†æ¬¡ç”Ÿæˆè®ºå›è®¨è®º
        â””â”€ å¾ªç¯è¿­ä»£...

ã€T=15åˆ†é’Ÿã€‘å®Œæˆ3è½®è¿­ä»£
â””â”€ ReportEngineæ”¶é›†æ‰€æœ‰ç»“æœ â†’ ç”ŸæˆæŠ¥å‘Š
```

---

## ğŸ¤– ç¬¬å››é˜¶æ®µï¼šInsightEngineæ·±åº¦å‰–æï¼ˆâ­ æ ¸å¿ƒï¼‰

> **ä¸ºä»€ä¹ˆå…ˆè®²InsightEngineï¼Ÿ**
> 1. å®ƒæ˜¯åŠŸèƒ½æœ€å¤æ‚ã€å·¥å…·æœ€å¤šçš„Agent
> 2. æœ€èƒ½ä½“ç°Agentçš„è®¾è®¡æ€æƒ³ï¼ˆNodeèŠ‚ç‚¹è®¾è®¡ã€å·¥å…·è°ƒç”¨ã€åæ€æœºåˆ¶ï¼‰
> 3. æŒæ¡InsightEngineåï¼Œå…¶ä»–Agentçš„ç†è§£ä¼šå˜å¾—å®¹æ˜“

### 4.1 InsightEngineæ¦‚è§ˆ

#### æ ¸å¿ƒèŒè´£

**ä»ç§æœ‰èˆ†æƒ…æ•°æ®åº“ä¸­æŒ–æ˜æ·±åº¦ä¿¡æ¯**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     InsightEngineçš„ç‹¬ç‰¹ä»·å€¼          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… è®¿é—®ç§æœ‰æ•°æ®åº“ï¼ˆå…¶ä»–Agentåšä¸åˆ°ï¼‰  â”‚
â”‚ âœ… æŸ¥è¯¢å†å²æ•°æ®ï¼ˆå¯¹æ¯”è¶‹åŠ¿ï¼‰           â”‚
â”‚ âœ… æƒ…æ„Ÿåˆ†æï¼ˆåˆ¤æ–­èˆ†è®ºå€¾å‘ï¼‰           â”‚
â”‚ âœ… è·å–å¤§ä¼—è¯„è®ºï¼ˆäº†è§£çœŸå®å£°éŸ³ï¼‰       â”‚
â”‚ âœ… è·¨å¹³å°å¯¹æ¯”ï¼ˆå¾®åšvså°çº¢ä¹¦vsæŠ–éŸ³ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å·¥å…·ç®±ï¼ˆ6å¤§æ ¸å¿ƒå·¥å…·ï¼‰

| å·¥å…·åç§° | åŠŸèƒ½æè¿° | SQLç¤ºä¾‹ | ä½¿ç”¨åœºæ™¯ |
|---------|---------|--------|---------|
| `search_hot_content` | æœç´¢çƒ­æ¦œå†…å®¹ | `SELECT * FROM hot_content WHERE...` | äº†è§£å½“å‰çƒ­ç‚¹ |
| `search_topic_globally` | å…¨å±€è¯é¢˜æœç´¢ | `SELECT * FROM topics WHERE title LIKE '%å…³é”®è¯%'` | æŸ¥æ‰¾ç›¸å…³è¯é¢˜ |
| `search_topic_by_date` | æŒ‰æ—¥æœŸæœç´¢ | `WHERE date BETWEEN '2025-01-01' AND '2025-01-31'` | åˆ†ææ—¶é—´è¶‹åŠ¿ |
| `get_comments_for_topic` | è·å–è¯é¢˜è¯„è®º | `SELECT * FROM comments WHERE topic_id=xxx` | æ·±å…¥äº†è§£è§‚ç‚¹ |
| `search_topic_on_platform` | å¹³å°å®šå‘æœç´¢ | `WHERE platform='weibo'` | å¯¹æ¯”å¹³å°å·®å¼‚ |
| `sentiment_analyzer` | æƒ…æ„Ÿåˆ†æ | ï¼ˆè°ƒç”¨MLæ¨¡å‹ï¼‰ | åˆ¤æ–­æ­£è´Ÿé¢æƒ…ç»ª |

### 4.2 å†…éƒ¨æ¶æ„ï¼šNodeèŠ‚ç‚¹è®¾è®¡

#### ä»€ä¹ˆæ˜¯NodeèŠ‚ç‚¹ï¼Ÿ

**Node**ï¼ˆèŠ‚ç‚¹ï¼‰æ˜¯Agentå†…éƒ¨çš„**å¤„ç†å•å…ƒ**ï¼Œæ¯ä¸ªNodeè´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡ã€‚

**ç±»æ¯”**ï¼šå·¥å‚æµæ°´çº¿
```
åŸææ–™ â†’ ã€åˆ‡å‰²Nodeã€‘â†’ ã€æ‰“ç£¨Nodeã€‘â†’ ã€ç»„è£…Nodeã€‘â†’ ã€æ£€æµ‹Nodeã€‘â†’ æˆå“

ç”¨æˆ·æŸ¥è¯¢ â†’ ã€è§„åˆ’Nodeã€‘â†’ ã€æœç´¢Nodeã€‘â†’ ã€æ€»ç»“Nodeã€‘â†’ ã€åæ€Nodeã€‘â†’ æœ€ç»ˆæŠ¥å‘Š
```

#### InsightEngineçš„Nodeæµæ°´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        InsightEngine èŠ‚ç‚¹æµæ°´çº¿                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥ï¼šç”¨æˆ·æŸ¥è¯¢ï¼ˆä¾‹å¦‚ï¼š"åˆ†ææ­¦æ±‰å¤§å­¦èˆ†æƒ…"ï¼‰
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 1: ReportStructureNode           â”‚
â”‚ ä½œç”¨ï¼šç†è§£éœ€æ±‚ï¼Œåˆ¶å®šç ”ç©¶å¤§çº²           â”‚
â”‚ è¾“å‡ºï¼š{"topic": "æ­¦æ±‰å¤§å­¦",           â”‚
â”‚        "search_plan": [...]}          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 2: FirstSearchNode               â”‚
â”‚ ä½œç”¨ï¼šæ‰§è¡Œåˆæ¬¡æœç´¢                     â”‚
â”‚ æ–¹æ³•ï¼šè°ƒç”¨å·¥å…·ç®±ä¸­çš„æœç´¢å·¥å…·           â”‚
â”‚ è¾“å‡ºï¼šåŸå§‹æœç´¢ç»“æœï¼ˆæ•°ç™¾æ¡æ•°æ®ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 3: FirstSummaryNode              â”‚
â”‚ ä½œç”¨ï¼šæ€»ç»“é¦–æ¬¡æœç´¢çš„å…³é”®ä¿¡æ¯           â”‚
â”‚ è¾“å‡ºï¼šç»“æ„åŒ–æ€»ç»“ï¼ˆé‡ç‚¹è¯é¢˜ã€çƒ­åº¦åˆ†æï¼‰ â”‚
â”‚ ğŸ“ ä¼šå†™å…¥ã€è®ºå›å‘è¨€ã€‘ä¾›å…¶ä»–Agentè¯»å–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Node 4: ReflectionNode                â”‚
â”‚ ä½œç”¨ï¼šåæ€å½“å‰ç»“æœï¼Œå†³å®šæ˜¯å¦éœ€è¦è¡¥å……   â”‚
â”‚ è¾“å‡ºï¼š{"need_more": True/False,       â”‚
â”‚        "suggestions": [...]}          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
         éœ€è¦è¡¥å……ï¼Ÿ
       â”Œâ”€â”€â”€Noâ”€â”€â”€â”€â”
       â†“         â†“Yes
     ç»“æŸ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Node 5: ReflectionSearchNode      â”‚
             â”‚ ä½œç”¨ï¼šåŸºäºåæ€å»ºè®®è¿›è¡Œè¡¥å……æœç´¢     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Node 6: ReflectionSummaryNode     â”‚
             â”‚ ä½œç”¨ï¼šæ€»ç»“è¡¥å……æœç´¢çš„å‘ç°           â”‚
             â”‚ ğŸ“ å†æ¬¡å†™å…¥ã€è®ºå›å‘è¨€ã€‘            â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                    å¾ªç¯2-3è½®
                         â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Node 7: ReportFormattingNode      â”‚
             â”‚ ä½œç”¨ï¼šæ ¼å¼åŒ–æœ€ç»ˆæŠ¥å‘Š               â”‚
             â”‚ è¾“å‡ºï¼šMarkdownæ ¼å¼çš„åˆ†ææŠ¥å‘Š       â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ä»£ç å‰–æï¼š`InsightEngine/agent.py`

#### æ ¸å¿ƒç±»ï¼šDeepSearchAgent

**åˆå§‹åŒ–æ–¹æ³•ï¼š__init__()**

```python
# æ–‡ä»¶ï¼šInsightEngine/agent.pyï¼ˆåŸºäºçœŸå®ä»£ç ï¼‰

class DeepSearchAgent:
    """Deep Search Agentä¸»ç±»"""

    def __init__(self, config: Optional[Settings] = None):
        """åˆå§‹åŒ–Agent"""
        self.config = config or settings

        # 1. åˆå§‹åŒ–LLMå®¢æˆ·ç«¯ï¼ˆå¤§è„‘ï¼‰
        self.llm_client = LLMClient(
            api_key=self.config.INSIGHT_ENGINE_API_KEY,
            model_name=self.config.INSIGHT_ENGINE_MODEL_NAME,
            base_url=self.config.INSIGHT_ENGINE_BASE_URL,
        )

        # 2. åˆå§‹åŒ–æœç´¢å·¥å…·é›†ï¼ˆå·¥å…·ç®±ï¼‰
        self.search_agency = MediaCrawlerDB()  # æ•°æ®åº“æŸ¥è¯¢å·¥å…·

        # 3. åˆå§‹åŒ–æƒ…æ„Ÿåˆ†æå™¨
        self.sentiment_analyzer = multilingual_sentiment_analyzer

        # 4. åˆå§‹åŒ–æ‰€æœ‰èŠ‚ç‚¹ï¼ˆæµæ°´çº¿ï¼‰
        self.first_search_node = FirstSearchNode(self.llm_client)
        self.reflection_node = ReflectionNode(self.llm_client)
        self.first_summary_node = FirstSummaryNode(self.llm_client)
        self.reflection_summary_node = ReflectionSummaryNode(self.llm_client)
        self.report_formatting_node = ReportFormattingNode(self.llm_client)

        # 5. åˆå§‹åŒ–çŠ¶æ€
        self.state = State()  # å­˜å‚¨ä¸­é—´ç»“æœ

        logger.info("Insight Agentå·²åˆå§‹åŒ–")
        logger.info(f"ä½¿ç”¨LLM: {self.llm_client.get_model_info()}")
        logger.info("æœç´¢å·¥å…·é›†: MediaCrawlerDB (æ”¯æŒ5ç§æ•°æ®åº“æŸ¥è¯¢å·¥å…·)")
        logger.info("æƒ…æ„Ÿåˆ†æ: WeiboMultilingualSentiment (æ”¯æŒ22ç§è¯­è¨€)")
```

**ç»„æˆéƒ¨åˆ†è§£æ**ï¼š
```
DeepSearchAgent
â”œâ”€ llm_client         â† å¤§è„‘ï¼ˆå†³ç­–ä¸­å¿ƒï¼‰
â”œâ”€ search_agency      â† å·¥å…·ç®±ï¼ˆæ‰§è¡Œèƒ½åŠ›ï¼‰
â”œâ”€ sentiment_analyzer â† ä¸“ä¸šåˆ†æèƒ½åŠ›
â”œâ”€ å„ç§NodeèŠ‚ç‚¹        â† å¤„ç†æµæ°´çº¿
â””â”€ state              â† è®°å¿†ï¼ˆå­˜å‚¨ä¸­é—´ç»“æœï¼‰
```

#### æ ¸å¿ƒæ–¹æ³•ï¼šexecute_search_tool()

**ä½œç”¨**ï¼šæ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢å·¥å…·ï¼ˆå¹¶é›†æˆå…³é”®è¯ä¼˜åŒ–å’Œæƒ…æ„Ÿåˆ†æï¼‰

```python
def execute_search_tool(self, tool_name: str, query: str, **kwargs) -> DBResponse:
    """
    æ‰§è¡ŒæŒ‡å®šçš„æ•°æ®åº“æŸ¥è¯¢å·¥å…·

    Args:
        tool_name: å·¥å…·åç§°ï¼Œå¦‚"search_topic_globally"
        query: æœç´¢å…³é”®è¯ï¼Œå¦‚"æ­¦æ±‰å¤§å­¦"
        **kwargs: é¢å¤–å‚æ•°ï¼ˆæ—¥æœŸèŒƒå›´ã€å¹³å°ã€é™åˆ¶æ•°é‡ç­‰ï¼‰

    Returns:
        DBResponseå¯¹è±¡ï¼ˆåŒ…å«æœç´¢ç»“æœå’Œæƒ…æ„Ÿåˆ†æï¼‰
    """
    logger.info(f"  â†’ æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢å·¥å…·: {tool_name}")

    # ğŸ”‘ å…³é”®æ­¥éª¤1ï¼šå…³é”®è¯ä¼˜åŒ–
    # ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿç”¨æˆ·è¾“å…¥"æ­¦æ±‰å¤§å­¦"ï¼Œä½†æ•°æ®åº“ä¸­å¯èƒ½æ˜¯"æ­¦å¤§"ã€"WHU"
    optimized_response = keyword_optimizer.optimize_keywords(
        original_query=query,
        context=f"ä½¿ç”¨{tool_name}å·¥å…·è¿›è¡ŒæŸ¥è¯¢"
    )

    logger.info(f"  ğŸ” åŸå§‹æŸ¥è¯¢: '{query}'")
    logger.info(f"  âœ¨ ä¼˜åŒ–åå…³é”®è¯: {optimized_response.optimized_keywords}")
    # è¾“å‡ºç¤ºä¾‹ï¼š['æ­¦æ±‰å¤§å­¦', 'æ­¦å¤§', 'WHU', 'Wuhan University']

    # ğŸ”‘ å…³é”®æ­¥éª¤2ï¼šä½¿ç”¨ä¼˜åŒ–åçš„å…³é”®è¯è¿›è¡Œå¤šæ¬¡æŸ¥è¯¢
    all_results = []
    for keyword in optimized_response.optimized_keywords:
        logger.info(f"    æŸ¥è¯¢å…³é”®è¯: '{keyword}'")

        if tool_name == "search_topic_globally":
            # å…¨å±€æœç´¢
            response = self.search_agency.search_topic_globally(
                topic=keyword,
                limit_per_table=self.config.DEFAULT_SEARCH_TOPIC_GLOBALLY_LIMIT_PER_TABLE
            )
        elif tool_name == "get_comments_for_topic":
            # è·å–è¯„è®º
            response = self.search_agency.get_comments_for_topic(
                topic=keyword,
                limit=self.config.DEFAULT_GET_COMMENTS_FOR_TOPIC_LIMIT
            )
        # ... å…¶ä»–å·¥å…·ç±»ä¼¼ ...

        if response.results:
            logger.info(f"     æ‰¾åˆ° {len(response.results)} æ¡ç»“æœ")
            all_results.extend(response.results)

    # ğŸ”‘ å…³é”®æ­¥éª¤3ï¼šå»é‡
    unique_results = self._deduplicate_results(all_results)
    logger.info(f"  æ€»è®¡æ‰¾åˆ° {len(all_results)} æ¡ï¼Œå»é‡å {len(unique_results)} æ¡")

    # ğŸ”‘ å…³é”®æ­¥éª¤4ï¼šæƒ…æ„Ÿåˆ†æ
    sentiment_analysis = self._perform_sentiment_analysis(unique_results)
    logger.info(f"  ğŸ­ æƒ…æ„Ÿåˆ†æå®Œæˆ")

    # æ„å»ºæœ€ç»ˆå“åº”
    return DBResponse(
        tool_name=f"{tool_name}_optimized",
        parameters={
            "original_query": query,
            "optimized_keywords": optimized_response.optimized_keywords,
            "sentiment_analysis": sentiment_analysis
        },
        results=unique_results,
        results_count=len(unique_results)
    )
```

**æµç¨‹å›¾è§£**ï¼š
```
execute_search_tool("search_topic_globally", "æ­¦æ±‰å¤§å­¦")
         â†“
ã€æ­¥éª¤1ã€‘å…³é”®è¯ä¼˜åŒ–
         keyword_optimizer.optimize_keywords("æ­¦æ±‰å¤§å­¦")
         â†“
         è¿”å›ï¼š['æ­¦æ±‰å¤§å­¦', 'æ­¦å¤§', 'WHU', 'Wuhan University']
         â†“
ã€æ­¥éª¤2ã€‘å¤šå…³é”®è¯æŸ¥è¯¢
         for 'æ­¦æ±‰å¤§å­¦': æ‰¾åˆ°150æ¡
         for 'æ­¦å¤§': æ‰¾åˆ°120æ¡
         for 'WHU': æ‰¾åˆ°30æ¡
         for 'Wuhan University': æ‰¾åˆ°10æ¡
         æ€»è®¡ï¼š310æ¡
         â†“
ã€æ­¥éª¤3ã€‘å»é‡
         _deduplicate_results()
         â†“
         å»é‡åï¼š200æ¡ï¼ˆå»é™¤é‡å¤çš„110æ¡ï¼‰
         â†“
ã€æ­¥éª¤4ã€‘æƒ…æ„Ÿåˆ†æ
         _perform_sentiment_analysis(200æ¡æ•°æ®)
         â†“
         ç»“æœï¼šæ­£é¢75%ã€è´Ÿé¢15%ã€ä¸­æ€§10%
         â†“
ã€è¾“å‡ºã€‘DBResponseå¯¹è±¡
         åŒ…å«ï¼š200æ¡ç»“æœ + æƒ…æ„Ÿåˆ†ææ•°æ®
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**
```
ä¼˜åŠ¿1ï¼šå…³é”®è¯ä¼˜åŒ– â†’ æé«˜å¬å›ç‡
  ç”¨æˆ·åªè¾“å…¥"æ­¦æ±‰å¤§å­¦"ï¼Œä½†æ•°æ®åº“ä¸­å¯èƒ½ç”¨ç®€ç§°"æ­¦å¤§"
  é€šè¿‡å…³é”®è¯ä¼˜åŒ–ï¼Œèƒ½æ‰¾åˆ°æ›´å¤šç›¸å…³æ•°æ®

ä¼˜åŠ¿2ï¼šå¤šå…³é”®è¯æŸ¥è¯¢ â†’ å…¨é¢è¦†ç›–
  ä¸åŒå…³é”®è¯å¯èƒ½åŒ¹é…ä¸åŒçš„æ•°æ®
  æ•´åˆæ‰€æœ‰ç»“æœï¼Œé¿å…é—æ¼

ä¼˜åŠ¿3ï¼šå»é‡ â†’ æé«˜è´¨é‡
  ä¸åŒå…³é”®è¯å¯èƒ½æŸ¥åˆ°åŒä¸€æ¡æ•°æ®
  å»é‡åé¿å…é‡å¤åˆ†æ

ä¼˜åŠ¿4ï¼šè‡ªåŠ¨æƒ…æ„Ÿåˆ†æ â†’ å¢åŠ æ·±åº¦
  ä¸ä»…è¿”å›æ•°æ®ï¼Œè¿˜åˆ†ææƒ…æ„Ÿå€¾å‘
  å¸®åŠ©LLMæ›´å¥½åœ°ç†è§£èˆ†æƒ…
```

### 4.4 NodeèŠ‚ç‚¹è¯¦è§£

#### Node 1: FirstSearchNodeï¼ˆé¦–æ¬¡æœç´¢èŠ‚ç‚¹ï¼‰

**ä»£ç ä½ç½®**ï¼š`InsightEngine/nodes/search_node.py`

**ä½œç”¨**ï¼šæ ¹æ®ç ”ç©¶è®¡åˆ’æ‰§è¡Œé¦–æ¬¡æœç´¢

**ä¼ªä»£ç **ï¼š
```python
class FirstSearchNode:
    def run(self, state):
        """æ‰§è¡Œé¦–æ¬¡æœç´¢"""
        # 1. è¯»å–è®ºå›å†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰
        forum_content = read_forum_summary()

        # 2. æ„å»ºPrompt
        prompt = f"""
ä½ çš„ä»»åŠ¡ï¼š{state.user_query}
ç ”ç©¶è®¡åˆ’ï¼š{state.research_plan}

å›¢é˜Ÿè®ºå›è®¨è®ºï¼š
{forum_content}

è¯·æ ¹æ®ç ”ç©¶è®¡åˆ’æ‰§è¡Œæœç´¢ï¼Œä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š
- search_topic_globally(topic="å…³é”®è¯")
- get_comments_for_topic(topic="å…³é”®è¯")
- ...

è¾“å‡ºJSONæ ¼å¼çš„å·¥å…·è°ƒç”¨åºåˆ—
"""

        # 3. LLMç”Ÿæˆå·¥å…·è°ƒç”¨è®¡åˆ’
        tool_calls = self.llm_client.generate_tool_calls(prompt)

        # 4. æ‰§è¡Œå·¥å…·è°ƒç”¨
        for tool_call in tool_calls:
            result = self.agent.execute_search_tool(
                tool_name=tool_call['name'],
                query=tool_call['query'],
                **tool_call.get('params', {})
            )
            state.search_results.append(result)

        return state
```

#### Node 2: FirstSummaryNodeï¼ˆé¦–æ¬¡æ€»ç»“èŠ‚ç‚¹ï¼‰

**ä»£ç ä½ç½®**ï¼š`InsightEngine/nodes/summary_node.py`

**ä½œç”¨**ï¼šæ€»ç»“é¦–æ¬¡æœç´¢çš„å…³é”®å‘ç°ï¼ˆå¹¶å†™å…¥è®ºå›ï¼‰

**ä¼ªä»£ç **ï¼š
```python
class FirstSummaryNode:
    def run(self, state):
        """ç”Ÿæˆé¦–æ¬¡æ€»ç»“"""
        logger.info("æ­£åœ¨ç”Ÿæˆé¦–æ¬¡æ®µè½æ€»ç»“")  # â† ForumEngineç›‘æ§æ­¤è¡Œ

        # 1. æ•´åˆæ‰€æœ‰æœç´¢ç»“æœ
        all_results = self._format_results(state.search_results)

        # 2. æ„å»ºPrompt
        prompt = f"""
ä½ åˆšåˆšå®Œæˆäº†å…³äº"{state.user_query}"çš„é¦–æ¬¡æœç´¢ï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹æ•°æ®ï¼š

{all_results}

è¯·æ€»ç»“ï¼š
1. æ ¸å¿ƒè¯é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ
2. çƒ­åº¦å¦‚ä½•ï¼Ÿ
3. ä¸»è¦è®¨è®ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ
4. æƒ…æ„Ÿå€¾å‘å¦‚ä½•ï¼Ÿ
"""

        # 3. LLMç”Ÿæˆæ€»ç»“
        summary = self.llm_client.generate(prompt)

        # 4. ğŸ”‘ å†™å…¥è®ºå›å‘è¨€ï¼ˆå…³é”®ï¼ï¼‰
        logger.info(f"ã€è®ºå›å‘è¨€ã€‘InsightEngineé¦–æ¬¡æ€»ç»“ï¼š{summary}")

        # 5. å­˜å…¥state
        state.summaries.append(summary)

        return state
```

**ä¸ºä»€ä¹ˆè¦å†™å…¥ã€è®ºå›å‘è¨€ã€‘ï¼Ÿ**
```
å½“logger.info("ã€è®ºå›å‘è¨€ã€‘...")æ—¶ï¼š
1. å†™å…¥logs/insight.logæ–‡ä»¶
2. ForumEngineç›‘æ§åˆ°è¿™æ¡æ—¥å¿—
3. æå–å‘è¨€å†…å®¹
4. åŠ å…¥agent_speeches_buffer
5. å½“bufferæ»¡5æ¡æ—¶ï¼Œè§¦å‘ä¸»æŒäººLLM
6. ä¸»æŒäººç”Ÿæˆæ€»ç»“ï¼Œå†™å…¥forum.log
7. å…¶ä»–Agentè¯»å–forum.logï¼Œäº†è§£InsightEngineçš„å‘ç°
```

#### Node 3: ReflectionNodeï¼ˆåæ€èŠ‚ç‚¹ï¼‰

**ä½œç”¨**ï¼šè¯„ä¼°å½“å‰ç»“æœè´¨é‡ï¼Œå†³å®šæ˜¯å¦éœ€è¦è¡¥å……æœç´¢

**ä¼ªä»£ç **ï¼š
```python
class ReflectionNode:
    def run(self, state):
        """åæ€å½“å‰ç»“æœ"""
        # 1. è¯»å–æœ€æ–°è®ºå›å†…å®¹
        forum_content = read_forum_summary()

        # 2. æ„å»ºPrompt
        prompt = f"""
ä½ åˆšåˆšå®Œæˆäº†é¦–æ¬¡æœç´¢å’Œæ€»ç»“ï¼š
{state.summaries[-1]}

å›¢é˜Ÿè®ºå›æœ€æ–°è®¨è®ºï¼š
{forum_content}

è¯·åæ€ï¼š
1. å½“å‰ç»“æœæ˜¯å¦è¶³å¤Ÿå…¨é¢ï¼Ÿ
2. æ˜¯å¦é—æ¼äº†é‡è¦è§’åº¦ï¼Ÿ
3. è®ºå›ä¸­å…¶ä»–Agentæåˆ°äº†å“ªäº›æˆ‘æ²¡æœ‰æœç´¢çš„æ–¹å‘ï¼Ÿ
4. æ˜¯å¦éœ€è¦è¡¥å……æœç´¢ï¼Ÿ

è¾“å‡ºJSONæ ¼å¼ï¼š
{
  "is_complete": true/false,
  "missing_aspects": [...],
  "suggestions": [...]
}
"""

        # 3. LLMåæ€
        reflection = self.llm_client.generate_json(prompt)

        # 4. å­˜å…¥state
        state.reflections.append(reflection)

        # 5. å†³å®šæ˜¯å¦ç»§ç»­
        if reflection['is_complete']:
            return "FINISH"  # ç»“æŸ
        else:
            return "CONTINUE"  # ç»§ç»­æœç´¢
```

**åæ€æœºåˆ¶çš„ä»·å€¼**ï¼š
```
ã€æ²¡æœ‰åæ€ã€‘
Agentæ‰§è¡Œä¸€æ¬¡æœç´¢ â†’ ç”Ÿæˆæ€»ç»“ â†’ ç»“æŸ
å¯èƒ½é—æ¼é‡è¦ä¿¡æ¯

ã€æœ‰åæ€ã€‘
Agentæ‰§è¡Œæœç´¢ â†’ ç”Ÿæˆæ€»ç»“ â†’ åæ€æ˜¯å¦å®Œæ•´
  â†’ å‘ç°é—æ¼ â†’ è¡¥å……æœç´¢ â†’ å†æ¬¡æ€»ç»“
  â†’ å†æ¬¡åæ€ â†’ ...
  â†’ å¾ªç¯2-3è½®ï¼Œç¡®ä¿å…¨é¢æ€§
```

---

## ğŸ”¥ ç¬¬äº”é˜¶æ®µï¼šå…¶ä»–ä¸‰ä¸ªAgentè§£æ

### 5.1 QueryEngineï¼ˆç½‘ç»œæœç´¢Agentï¼‰

#### æ ¸å¿ƒèŒè´£
åœ¨å›½å†…å¤–äº’è”ç½‘ä¸Šæœç´¢ç›¸å…³æ–°é—»ã€è®¨è®ºã€æ–‡ç« 

#### å·¥å…·ç®±
- **Tavily API**ï¼šå›½é™…æœç´¢ï¼ˆGoogleã€Bingç­‰ï¼‰
- **Bocha API**ï¼šå›½å†…æœç´¢ï¼ˆç™¾åº¦ã€æœç‹—ç­‰ï¼‰
- **ç½‘é¡µå†…å®¹æå–**ï¼šBeautiful Soupã€æ­£åˆ™è¡¨è¾¾å¼

#### ä¸InsightEngineçš„åŒºåˆ«
| ç»´åº¦ | QueryEngine | InsightEngine |
|------|------------|--------------|
| æ•°æ®æ¥æº | äº’è”ç½‘å…¬å¼€ä¿¡æ¯ | ç§æœ‰æ•°æ®åº“ |
| æ•°æ®ç‰¹ç‚¹ | éç»“æ„åŒ–æ–‡æœ¬ | ç»“æ„åŒ–æ•°æ® |
| æŸ¥è¯¢æ–¹å¼ | æœç´¢API | SQLæŸ¥è¯¢ |
| ä¼˜åŠ¿ | ä¿¡æ¯å¹¿åº¦ã€å®æ—¶æ€§ | å†å²æ·±åº¦ã€ç²¾å‡†æ€§ |

#### ç®€åŒ–çš„å·¥ä½œæµç¨‹
```
QueryEngine.run("åˆ†ææ­¦æ±‰å¤§å­¦èˆ†æƒ…")
  â†“
1. ç”Ÿæˆæœç´¢å…³é”®è¯
   LLM: "æ­¦æ±‰å¤§å­¦"ã€"WHU"ã€"æ­¦æ±‰å¤§å­¦ æ–°é—»"
  â†“
2. è°ƒç”¨Tavily APIæœç´¢
   æ‰¾åˆ°ï¼š15æ¡æ–°é—»ã€10æ¡ç¤¾äº¤åª’ä½“è®¨è®º
  â†“
3. æå–ç½‘é¡µå†…å®¹
   ä½¿ç”¨BeautifulSoupè§£æHTML
  â†“
4. æ€»ç»“å…³é”®ä¿¡æ¯
   LLMæ€»ç»“ï¼šçƒ­ç‚¹è¯é¢˜ã€èˆ†è®ºèµ°å‘
  â†“
5. å†™å…¥ã€è®ºå›å‘è¨€ã€‘
   ä¾›å…¶ä»–Agentå‚è€ƒ
```

### 5.2 MediaEngineï¼ˆå¤šæ¨¡æ€åˆ†æAgentï¼‰

#### æ ¸å¿ƒèŒè´£
åˆ†æå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰å¤šæ¨¡æ€å†…å®¹

#### æ ¸å¿ƒèƒ½åŠ›
- **å›¾ç‰‡OCR**ï¼šæå–å›¾ç‰‡ä¸­çš„æ–‡å­—
- **è§†é¢‘ç†è§£**ï¼šåˆ†æè§†é¢‘å†…å®¹ã€å…³é”®å¸§
- **ç»“æ„åŒ–ä¿¡æ¯æå–**ï¼šå¤©æ°”å¡ç‰‡ã€æ—¥å†ã€è‚¡ç¥¨ç­‰

#### ä¸ºä»€ä¹ˆéœ€è¦ç‹¬ç«‹çš„MediaEngineï¼Ÿ
```
åœºæ™¯ï¼šåˆ†ææŸå“ç‰Œèˆ†æƒ…

QueryEngine: æœç´¢åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œæåˆ°"æŸå“ç‰Œæ–°å“å‘å¸ƒä¼š"
             ä½†æ–‡ç« ä¸­æœ‰å¤§é‡äº§å“å›¾ç‰‡
             QueryEngineæ— æ³•ç†è§£å›¾ç‰‡å†…å®¹

MediaEngine: åˆ†æå›¾ç‰‡ï¼Œè¯†åˆ«å‡ºï¼š
             - äº§å“å¤–è§‚è®¾è®¡
             - äº§å“ç‰¹æ€§ï¼ˆä»å›¾ç‰‡æ–‡å­—æå–ï¼‰
             - ç°åœºè§‚ä¼—ååº”ï¼ˆä»è§†é¢‘åˆ†æï¼‰
             â†’ âœ… è¡¥å……äº†é‡è¦ä¿¡æ¯ï¼
```

#### ç®€åŒ–çš„å·¥ä½œæµç¨‹
```
MediaEngine.run("åˆ†ææ­¦æ±‰å¤§å­¦èˆ†æƒ…")
  â†“
1. æœç´¢ç›¸å…³å¤šæ¨¡æ€å†…å®¹
   è°ƒç”¨æœç´¢APIï¼Œç­›é€‰å›¾ç‰‡ã€è§†é¢‘ç»“æœ
  â†“
2. è°ƒç”¨å¤šæ¨¡æ€LLMï¼ˆGeminiï¼‰
   è¾“å…¥ï¼šå›¾ç‰‡URLã€è§†é¢‘URL
   Promptï¼š"è¿™å¼ å›¾ç‰‡/è§†é¢‘åœ¨è®¨è®ºä»€ä¹ˆï¼Ÿæƒ…æ„Ÿå€¾å‘å¦‚ä½•ï¼Ÿ"
  â†“
3. æå–ç»“æ„åŒ–ä¿¡æ¯
   å¦‚æœæ˜¯ä¿¡æ¯å¡ç‰‡ï¼ˆå¤©æ°”ã€æ—¥å†ç­‰ï¼‰ï¼Œæå–ç»“æ„åŒ–æ•°æ®
  â†“
4. æ€»ç»“å¤šæ¨¡æ€å†…å®¹
   LLMæ€»ç»“ï¼šè§†é¢‘ä¸»é¢˜ã€å›¾ç‰‡æƒ…æ„Ÿã€å…³é”®ä¿¡æ¯
  â†“
5. å†™å…¥ã€è®ºå›å‘è¨€ã€‘
```

### 5.3 ReportEngineï¼ˆæŠ¥å‘Šç”ŸæˆAgentï¼‰

#### æ ¸å¿ƒèŒè´£
æ”¶é›†æ‰€æœ‰Agentçš„åˆ†æç»“æœï¼Œç”Ÿæˆä¸“ä¸šHTMLæŠ¥å‘Š

#### å·¥ä½œæµç¨‹
```
ReportEngine.run()
  â†“
1. æ”¶é›†æ‰€æœ‰Agentçš„ç»“æœ
   â”œâ”€ QueryEngineçš„ç½‘ç»œæœç´¢ç»“æœ
   â”œâ”€ MediaEngineçš„å¤šæ¨¡æ€åˆ†æ
   â”œâ”€ InsightEngineçš„æ•°æ®åº“æŒ–æ˜
   â””â”€ ForumEngineçš„è®ºå›è®¨è®ºè®°å½•
  â†“
2. é€‰æ‹©æŠ¥å‘Šæ¨¡æ¿
   æ ¹æ®ä»»åŠ¡ç±»å‹ï¼ˆå“ç‰Œåˆ†æ/çƒ­ç‚¹äº‹ä»¶/æ”¿ç­–å½±å“ï¼‰
   ä»report_template/ç›®å½•é€‰æ‹©åˆé€‚æ¨¡æ¿
  â†“
3. å¤šè½®ç”ŸæˆæŠ¥å‘Š
   ç¬¬1è½®ï¼šç”Ÿæˆåˆç¨¿
   ç¬¬2è½®ï¼šæ£€æŸ¥è´¨é‡ï¼Œè¡¥å……ç»†èŠ‚
   ç¬¬3è½®ï¼šç¾åŒ–æ ¼å¼
  â†“
4. è¾“å‡ºHTMLæ–‡ä»¶
   ä½¿ç”¨Markdownè½¬HTML
   æ·»åŠ CSSæ ·å¼
   ä¿å­˜åˆ°final_reports/ç›®å½•
```

#### æŠ¥å‘Šæ¨¡æ¿ç¤ºä¾‹
```markdown
# {å“ç‰Œåç§°}èˆ†æƒ…åˆ†ææŠ¥å‘Š

## ä¸€ã€èˆ†æƒ…æ¦‚è§ˆ
{ç»¼åˆçƒ­åº¦åˆ†æ}

## äºŒã€çƒ­ç‚¹è¯é¢˜
{æ ¸å¿ƒè¯é¢˜åˆ—è¡¨}

## ä¸‰ã€æƒ…æ„Ÿåˆ†æ
{æ­£è´Ÿé¢æƒ…ç»ªåˆ†å¸ƒ}

## å››ã€å¹³å°å¯¹æ¯”
{ä¸åŒå¹³å°çš„èˆ†æƒ…å·®å¼‚}

## äº”ã€è¶‹åŠ¿é¢„æµ‹
{æœªæ¥èµ°å‘åˆ†æ}
```

---

## ğŸŒŸ ç¬¬å…­é˜¶æ®µï¼šå®Œæ•´åä½œæµç¨‹å®æˆ˜

### 6.1 æ¡ˆä¾‹ï¼šåˆ†æ"æ­¦æ±‰å¤§å­¦å“ç‰Œå£°èª‰"

#### å®Œæ•´æ—¶é—´è½´ï¼ˆçœŸå®æµç¨‹ï¼‰

**ã€0:00ã€‘ç”¨æˆ·æé—®**
```
ç”¨æˆ·åœ¨Webç•Œé¢è¾“å…¥ï¼š"åˆ†ææ­¦æ±‰å¤§å­¦å“ç‰Œå£°èª‰"
Flask app.pyæ¥æ”¶è¯·æ±‚
```

**ã€0:05ã€‘ç³»ç»Ÿåˆå§‹åŒ–**
```
1. å¯åŠ¨ForumEngineç›‘æ§ï¼ˆåå°çº¿ç¨‹ï¼‰
2. æ¸…ç©ºlogs/forum.log
3. å¹¶è¡Œå¯åŠ¨3ä¸ªAgentï¼š
   â”œâ”€ QueryEngineï¼ˆç«¯å£8503ï¼‰
   â”œâ”€ MediaEngineï¼ˆç«¯å£8502ï¼‰
   â””â”€ InsightEngineï¼ˆç«¯å£8501ï¼‰
```

**ã€0:10-2:00ã€‘åˆæ­¥æœç´¢é˜¶æ®µ**
```
QueryEngine:
  â”œâ”€ è°ƒç”¨Tavilyæœç´¢"æ­¦æ±‰å¤§å­¦"
  â”œâ”€ æ‰¾åˆ°15æ¡æ–°é—»ã€10æ¡è®¨è®º
  â””â”€ æ€»ç»“ï¼šæ’åä¸Šå‡ã€æ¨±èŠ±å­£è¯é¢˜çƒ­åº¦é«˜

MediaEngine:
  â”œâ”€ æœç´¢ç›¸å…³è§†é¢‘
  â”œâ”€ åˆ†æäº†20ä¸ªçŸ­è§†é¢‘
  â””â”€ æ€»ç»“ï¼šæ¨±èŠ±è§†é¢‘æ’­æ”¾é‡é«˜ã€è¯„è®ºæ­£é¢

InsightEngine:
  â”œâ”€ search_topic_globally("æ­¦æ±‰å¤§å­¦")
  â”œâ”€ æ‰¾åˆ°500æ¡å†å²æ•°æ®
  â”œâ”€ get_comments_for_topic() â†’ 1000æ¡è¯„è®º
  â”œâ”€ æƒ…æ„Ÿåˆ†æï¼šæ­£é¢78%ã€è´Ÿé¢12%ã€ä¸­æ€§10%
  â””â”€ æ€»ç»“ï¼šæ•´ä½“å£°èª‰è‰¯å¥½ï¼Œæ¨±èŠ±å­£æ˜¯æ ¸å¿ƒè¯é¢˜
```

**ã€2:00ã€‘é¦–æ¬¡è®ºå›æ€»ç»“è§¦å‘**
```
ForumEngineæ£€æµ‹åˆ°3ä¸ªAgentçš„FirstSummaryNodeï¼š
  â”œâ”€ QueryEngine: "æ¨±èŠ±å­£æ˜¯çƒ­ç‚¹"
  â”œâ”€ MediaEngine: "æ¨±èŠ±è§†é¢‘å¾ˆç«"
  â””â”€ InsightEngine: "æ¨±èŠ±è®¨è®ºé‡å¢é•¿300%"

ä¸»æŒäººLLMåˆ†æï¼š
  ã€é‡è¦å‘ç°ã€‘æ¨±èŠ±å­£æ˜¯æ ¸å¿ƒè¯é¢˜
  ã€å…³è”åˆ†æã€‘ä¸‰æ–¹è¯æ®ä¸€è‡´
  ã€ç ”ç©¶å»ºè®®ã€‘æ·±å…¥åˆ†ææ¨±èŠ±å­£èˆ†æƒ…ç»†èŠ‚

å†™å…¥logs/forum.log
```

**ã€2:05-5:00ã€‘æ·±åº¦ç ”ç©¶é˜¶æ®µï¼ˆç¬¬1è½®åæ€ï¼‰**
```
å„Agentè¯»å–è®ºå› â†’ è°ƒæ•´ç­–ç•¥ï¼š

QueryEngine:
  â”œâ”€ æœç´¢"æ­¦æ±‰å¤§å­¦ æ¨±èŠ±å­£"
  â”œâ”€ å‘ç°"é¢„çº¦åˆ¶åº¦"ç›¸å…³è®¨è®º
  â””â”€ æ€»ç»“ï¼šé¢„çº¦åˆ¶åº¦å¼•å‘éƒ¨åˆ†äº‰è®®

MediaEngine:
  â”œâ”€ é‡ç‚¹åˆ†ææ¨±èŠ±è§†é¢‘
  â”œâ”€ æå–è¯„è®ºæƒ…æ„Ÿ
  â””â”€ æ€»ç»“ï¼šè¯„è®ºä¸­æœ‰å¯¹é¢„çº¦åˆ¶åº¦çš„æŠ±æ€¨

InsightEngine:
  â”œâ”€ search_topic_on_platform(platform="weibo", topic="æ¨±èŠ±é¢„çº¦")
  â”œâ”€ æ‰¾åˆ°200æ¡ç›¸å…³è®¨è®º
  â”œâ”€ æƒ…æ„Ÿåˆ†æï¼šè´Ÿé¢æ¯”ä¾‹ä¸Šå‡åˆ°30%
  â””â”€ æ€»ç»“ï¼šé¢„çº¦åˆ¶åº¦æ˜¯æ½œåœ¨èˆ†æƒ…é£é™©ç‚¹
```

**ã€5:00ã€‘ç¬¬2è½®è®ºå›æ€»ç»“**
```
ForumEngineæ£€æµ‹åˆ°3ä¸ªAgentçš„ReflectionSummaryNodeï¼š
  â”œâ”€ QueryEngine: "é¢„çº¦åˆ¶åº¦æœ‰äº‰è®®"
  â”œâ”€ MediaEngine: "è§†é¢‘è¯„è®ºæœ‰æŠ±æ€¨"
  â””â”€ InsightEngine: "è´Ÿé¢æƒ…ç»ªä¸Šå‡"

ä¸»æŒäººLLMåˆ†æï¼š
  ã€é‡è¦å‘ç°ã€‘é¢„çº¦åˆ¶åº¦æ˜¯åŒåˆƒå‰‘
  ã€å…³è”åˆ†æã€‘ä¾¿åˆ©æ€§vså…¬å¹³æ€§çš„çŸ›ç›¾
  ã€ç ”ç©¶å»ºè®®ã€‘æ·±å…¥åˆ†æè´Ÿé¢è¯„è®ºçš„å…·ä½“åŸå› 

å†™å…¥logs/forum.log
```

**ã€5:05-8:00ã€‘æ·±åº¦ç ”ç©¶é˜¶æ®µï¼ˆç¬¬2è½®åæ€ï¼‰**
```
InsightEngine:
  â”œâ”€ get_comments_for_topic(topic="æ¨±èŠ±é¢„çº¦")
  â”œâ”€ æå–é«˜æƒ…æ„Ÿå¼ºåº¦çš„è´Ÿé¢è¯„è®º
  â”œâ”€ LLMåˆ†æè¯„è®ºä¸»é¢˜
  â””â”€ æ€»ç»“ï¼šä¸»è¦æŠ±æ€¨ç‚¹ï¼š
      1. é¢„çº¦ç³»ç»Ÿå´©æºƒ
      2. å¤–åœ°æ¸¸å®¢éš¾ä»¥é¢„çº¦
      3. é»„ç‰›å€’å–é¢„çº¦åé¢
```

**ã€8:00-10:00ã€‘æ”¶æ•›é˜¶æ®µ**
```
å„Agentå®Œæˆ2-3è½®åæ€ï¼Œç»“æœè¶‹äºç¨³å®š
ForumEngineåœæ­¢ç›‘æ§
ReportEngineå¼€å§‹å·¥ä½œ
```

**ã€10:00-12:00ã€‘æŠ¥å‘Šç”Ÿæˆ**
```
ReportEngine:
  1. æ”¶é›†æ‰€æœ‰Agentçš„ç»“æœ
     â”œâ”€ QueryEngine: ç½‘ç»œçƒ­åº¦åˆ†æ
     â”œâ”€ MediaEngine: è§†é¢‘å†…å®¹åˆ†æ
     â””â”€ InsightEngine: æ•°æ®åº“æ·±åº¦æŒ–æ˜

  2. è¯»å–è®ºå›è®¨è®ºè®°å½•
     äº†è§£å„Agentçš„å‘ç°å’Œåä½œè¿‡ç¨‹

  3. é€‰æ‹©æ¨¡æ¿
     ä»»åŠ¡ç±»å‹åˆ¤æ–­ä¸º"å“ç‰Œå£°èª‰ç›‘æµ‹"
     â†’ ä½¿ç”¨"å•†ä¸šå“ç‰Œèˆ†æƒ…ç›‘æµ‹.md"æ¨¡æ¿

  4. å¤šè½®ç”Ÿæˆ
     ç¬¬1è½®ï¼šç”Ÿæˆåˆç¨¿
     ç¬¬2è½®ï¼šè¡¥å……ç»†èŠ‚
     ç¬¬3è½®ï¼šç¾åŒ–æ ¼å¼

  5. è¾“å‡ºHTML
     ä¿å­˜åˆ°ï¼šfinal_reports/æ­¦æ±‰å¤§å­¦å“ç‰Œå£°èª‰_20250115.html
```

**ã€12:00ã€‘å®Œæˆï¼**
```
ç”¨æˆ·åœ¨Webç•Œé¢çœ‹åˆ°ï¼š
  âœ… åˆ†æå®Œæˆ
  âœ… ç‚¹å‡»ä¸‹è½½æŠ¥å‘Š
  âœ… æŸ¥çœ‹è¯¦ç»†åˆ†æç»“æœ
```

### 6.2 å…³é”®åä½œæ—¶åˆ»

#### æ—¶åˆ»1ï¼šé¿å…é‡å¤åŠ³åŠ¨
```
QueryEngineå‘ç°ï¼š"æ¨±èŠ±å­£æ˜¯çƒ­ç‚¹"
å†™å…¥è®ºå› â†’ InsightEngineè¯»å–
InsightEngineç­–ç•¥è°ƒæ•´ï¼š
  âŒ ä¸å†å…¨å±€æœç´¢"æ­¦æ±‰å¤§å­¦"
  âœ… é‡ç‚¹æœç´¢"æ­¦æ±‰å¤§å­¦ æ¨±èŠ±å­£"
  â†’ é¿å…äº†é‡å¤å·¥ä½œï¼
```

#### æ—¶åˆ»2ï¼šäº¤å‰éªŒè¯
```
QueryEngine: "æ¨±èŠ±å­£çƒ­åº¦é«˜"ï¼ˆæ¥è‡ªç½‘ç»œæœç´¢ï¼‰
MediaEngine: "æ¨±èŠ±è§†é¢‘å¾ˆç«"ï¼ˆæ¥è‡ªè§†é¢‘åˆ†æï¼‰
InsightEngine: "æ¨±èŠ±è®¨è®ºé‡å¢é•¿300%"ï¼ˆæ¥è‡ªæ•°æ®åº“ï¼‰
  â†’ ä¸‰æ–¹è¯æ®ç›¸äº’å°è¯ â†’ ç»“è®ºå¯ä¿¡åº¦é«˜ï¼
```

#### æ—¶åˆ»3ï¼šè¡¥å……é—æ¼
```
QueryEngineå’ŒMediaEngineéƒ½å‘ç°äº†"æ¨±èŠ±å­£"
ä½†InsightEngineæ·±å…¥æ•°æ®åº“åå‘ç°ï¼š
  "é¢„çº¦åˆ¶åº¦"æ˜¯æ½œåœ¨é£é™©ç‚¹
  â†’ æé†’å…¶ä»–Agentå…³æ³¨è¿™ä¸ªè§’åº¦
  â†’ MediaEngineé‡æ–°åˆ†æè§†é¢‘è¯„è®º
  â†’ QueryEngineè¡¥å……æœç´¢é¢„çº¦åˆ¶åº¦ç›¸å…³æ–°é—»
  â†’ å‘ç°äº†åŸæœ¬ä¼šé—æ¼çš„é‡è¦ä¿¡æ¯ï¼
```

---

## ğŸ“š é™„å½•ï¼šè¾…åŠ©çŸ¥è¯†ï¼ˆç®€åŒ–ç‰ˆï¼‰

### é™„å½•Aï¼šLLMæŠ€æœ¯åŸºç¡€

#### ä»€ä¹ˆæ˜¯LLMï¼Ÿ
å¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Modelï¼‰ï¼Œèƒ½ç†è§£å’Œç”Ÿæˆäººç±»è¯­è¨€çš„AIæ¨¡å‹

#### BettaFishå¦‚ä½•ä½¿ç”¨LLMï¼Ÿ
- **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰LLMè°ƒç”¨éƒ½ä½¿ç”¨OpenAIå…¼å®¹æ ¼å¼
- **é…ç½®æ–¹å¼**ï¼šåœ¨`.env`æ–‡ä»¶ä¸­é…ç½®APIå¯†é’¥å’Œæ¨¡å‹åç§°
- **è°ƒç”¨ç¤ºä¾‹**ï¼š
  ```python
  from openai import OpenAI
  client = OpenAI(api_key="...", base_url="...")
  response = client.chat.completions.create(
      model="model-name",
      messages=[{"role": "user", "content": "prompt"}]
  )
  ```

#### å¦‚ä½•é…ç½®ä¸åŒçš„LLMï¼Ÿ
ç¼–è¾‘`.env`æ–‡ä»¶ï¼š
```bash
# InsightEngineä½¿ç”¨Kimi
INSIGHT_ENGINE_API_KEY=sk-xxx
INSIGHT_ENGINE_BASE_URL=https://api.moonshot.cn/v1
INSIGHT_ENGINE_MODEL_NAME=kimi-k2-0711-preview

# MediaEngineä½¿ç”¨Gemini
MEDIA_ENGINE_API_KEY=xxx
MEDIA_ENGINE_BASE_URL=https://aihubmix.com/v1
MEDIA_ENGINE_MODEL_NAME=gemini-2.5-pro
```

### é™„å½•Bï¼šçˆ¬è™«æŠ€æœ¯åŸºç¡€

#### ä»€ä¹ˆæ˜¯çˆ¬è™«ï¼Ÿ
è‡ªåŠ¨åŒ–ç¨‹åºï¼Œæ¨¡æ‹Ÿäººç±»æµè§ˆç½‘é¡µï¼Œæ‰¹é‡æ”¶é›†æ•°æ®

#### BettaFishçš„çˆ¬è™«ï¼šMindSpider
- **ä½ç½®**ï¼š`MindSpider/`ç›®å½•
- **æŠ€æœ¯æ ˆ**ï¼šPlaywrightï¼ˆæ”¯æŒJavaScriptæ¸²æŸ“ï¼‰
- **æ”¯æŒå¹³å°**ï¼šå¾®åšã€å°çº¢ä¹¦ã€æŠ–éŸ³ã€å¿«æ‰‹
- **ä¸¤å¤§æ¨¡å—**ï¼š
  1. BroadTopicExtractionï¼šçƒ­ç‚¹è¯é¢˜æå–
  2. DeepSentimentCrawlingï¼šæ·±åº¦èˆ†æƒ…çˆ¬å–

#### å¦‚ä½•ä½¿ç”¨çˆ¬è™«ï¼Ÿ
```bash
cd MindSpider
python main.py --setup                    # åˆå§‹åŒ–
python main.py --broad-topic              # çˆ¬å–çƒ­ç‚¹
python main.py --deep-sentiment --platforms wb  # çˆ¬å–å¾®åš
```

**æ³¨æ„**ï¼šçˆ¬è™«ä»…ä¾›å­¦ä¹ ç ”ç©¶ï¼Œè¯·éµå®ˆæ³•å¾‹æ³•è§„å’Œç½‘ç«™robots.txtåè®®

### é™„å½•Cï¼šæ•°æ®åº“è®¾è®¡

#### æ ¸å¿ƒè¡¨ç»“æ„
- **hot_content**ï¼šçƒ­æ¦œå†…å®¹è¡¨
- **topics**ï¼šè¯é¢˜è¡¨
- **comments**ï¼šè¯„è®ºè¡¨
- **platform_data**ï¼šå¹³å°æ•°æ®è¡¨

#### æ”¯æŒçš„æ•°æ®åº“
- PostgreSQLï¼ˆæ¨èï¼‰
- MySQL

#### é…ç½®æ–¹å¼
ç¼–è¾‘`.env`æ–‡ä»¶ï¼š
```bash
DB_HOST=localhost
DB_PORT=5432
DB_USER=bettafish
DB_PASSWORD=bettafish
DB_NAME=bettafish
DB_DIALECT=postgresql
```

---

## ğŸ“ å­¦ä¹ æ£€æŸ¥æ¸…å•

### ç†è®ºç†è§£
- [ ] èƒ½è§£é‡Šä»€ä¹ˆæ˜¯å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ
- [ ] èƒ½è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦å¤šAgentè€Œä¸æ˜¯å•Agent
- [ ] ç†è§£å¹¶è¡Œæ¨¡å¼vsåä½œæ¨¡å¼çš„åŒºåˆ«
- [ ] èƒ½ç”»å‡ºBettaFishçš„æ•´ä½“æ¶æ„å›¾

### è®ºå›æœºåˆ¶
- [ ] ç†è§£è®ºå›åä½œæœºåˆ¶çš„è®¾è®¡åŠ¨æœº
- [ ] èƒ½è§£é‡ŠForumEngineçš„ç›‘æ§åŸç†
- [ ] çŸ¥é“ä¸ºä»€ä¹ˆç›‘æ§SummaryNode
- [ ] ç†è§£file_positionsçš„ä½œç”¨
- [ ] èƒ½è¯´æ˜ä¸»æŒäººLLMçš„èŒè´£

### Agentæ·±åº¦ç†è§£
- [ ] ç†è§£InsightEngineçš„6å¤§å·¥å…·
- [ ] èƒ½è§£é‡ŠNodeèŠ‚ç‚¹è®¾è®¡çš„æ„ä¹‰
- [ ] çŸ¥é“å…³é”®è¯ä¼˜åŒ–çš„ä½œç”¨
- [ ] ç†è§£åæ€æœºåˆ¶çš„ä»·å€¼
- [ ] èƒ½è¯´æ˜æƒ…æ„Ÿåˆ†æçš„å®ç°æ–¹å¼

### ä»£ç èƒ½åŠ›
- [ ] èƒ½è¯»æ‡‚`ForumEngine/monitor.py`çš„æ ¸å¿ƒé€»è¾‘
- [ ] èƒ½è¯»æ‡‚`InsightEngine/agent.py`çš„execute_search_tool()
- [ ] ç†è§£Agentå¦‚ä½•å†™å…¥ã€è®ºå›å‘è¨€ã€‘
- [ ] ç†è§£Agentå¦‚ä½•è¯»å–è®ºå›å†…å®¹
- [ ] èƒ½è¿½è¸ªä¸€æ¬¡å®Œæ•´çš„åä½œæµç¨‹

### å®æˆ˜èƒ½åŠ›
- [ ] èƒ½æ­å»ºå¼€å‘ç¯å¢ƒ
- [ ] èƒ½è¿è¡Œå®Œæ•´åˆ†ææµç¨‹
- [ ] èƒ½è¯»æ‡‚æ—¥å¿—æ–‡ä»¶ä¸­çš„åä½œè¿‡ç¨‹
- [ ] èƒ½ä¿®æ”¹Agentçš„é…ç½®å‚æ•°
- [ ] èƒ½å°è¯•æ·»åŠ æ–°çš„æœç´¢å·¥å…·

---

## ğŸ“– å­¦ä¹ å»ºè®®

### å­¦ä¹ é¡ºåº
1. **ç¬¬1-2å¤©**ï¼šç†è®ºåŸºç¡€ï¼ˆç¬¬ä¸€ã€äºŒé˜¶æ®µï¼‰
2. **ç¬¬3-6å¤©**ï¼šè®ºå›æœºåˆ¶æ·±åº¦ç†è§£ï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰
   - é‡ç‚¹é˜…è¯»`ForumEngine/monitor.py`ä»£ç 
   - è¿è¡Œç³»ç»Ÿï¼Œè§‚å¯Ÿæ—¥å¿—æ–‡ä»¶å˜åŒ–
3. **ç¬¬7-12å¤©**ï¼šInsightEngineæ·±åº¦å­¦ä¹ ï¼ˆç¬¬å››é˜¶æ®µï¼‰
   - é€ä¸ªç†è§£æ¯ä¸ªNode
   - å°è¯•ä¿®æ”¹å·¥å…·è°ƒç”¨é€»è¾‘
4. **ç¬¬13-18å¤©**ï¼šå…¶ä»–Agentå­¦ä¹ ï¼ˆç¬¬äº”é˜¶æ®µï¼‰
5. **ç¬¬19-22å¤©**ï¼šå®Œæ•´æµç¨‹å®æˆ˜ï¼ˆç¬¬å…­é˜¶æ®µï¼‰

### å­¦ä¹ æ–¹æ³•
1. **ä»£ç +æ—¥å¿—ç»“åˆ**ï¼šè¾¹è¯»ä»£ç ï¼Œè¾¹çœ‹æ—¥å¿—æ–‡ä»¶
2. **ç”»å›¾ç†è§£**ï¼šç”¨æµç¨‹å›¾æ¢³ç†é€»è¾‘
3. **åŠ¨æ‰‹ä¿®æ”¹**ï¼šå°è¯•è°ƒæ•´å‚æ•°ï¼Œè§‚å¯Ÿå˜åŒ–
4. **è¿½è¸ªä¸€æ¬¡æµç¨‹**ï¼šä»ç”¨æˆ·æé—®åˆ°æŠ¥å‘Šç”Ÿæˆï¼Œå®Œæ•´è¿½è¸ª
5. **é—®é¢˜é©±åŠ¨**ï¼šé‡åˆ°ç–‘é—®ç«‹å³æŸ¥ä»£ç éªŒè¯

### æ¨èå·¥å…·
- **VSCode**ï¼šä»£ç é˜…è¯»
- **Draw.io**ï¼šç”»æ¶æ„å›¾
- **Postman**ï¼šæµ‹è¯•API
- **DB Browser**ï¼šæŸ¥çœ‹æ•°æ®åº“

---

## ğŸ‰ ç»“è¯­

**æ­å–œä½ ï¼**å®Œæˆè¿™ä»½å­¦ä¹ æŒ‡å—åï¼Œä½ å°†ï¼š
- âœ… æ·±å…¥ç†è§£å¤šæ™ºèƒ½ä½“åä½œæœºåˆ¶
- âœ… æŒæ¡BettaFishçš„æ ¸å¿ƒè®¾è®¡æ€æƒ³
- âœ… èƒ½å¤ŸåŸºäºæ­¤æ¶æ„å¼€å‘è‡ªå·±çš„Agentç³»ç»Ÿ
- âœ… å…·å¤‡æ‰©å±•å’Œå®šåˆ¶èƒ½åŠ›

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š
1. åŒæ„è¿™ä»½å­¦ä¹ æŒ‡å— â†’ æˆ‘ä»¬å¼€å§‹è¯¦ç»†è®²è§£
2. æˆ–è€…å‘Šè¯‰æˆ‘ä½ æƒ³é‡ç‚¹å­¦ä¹ å“ªä¸ªéƒ¨åˆ† â†’ æˆ‘æ·±å…¥å±•å¼€

**å­¦ä¹ è¿‡ç¨‹ä¸­éšæ—¶æé—®ï¼**æˆ‘ä¼šç”¨ï¼š
- ğŸ—£ï¸ å¤§ç™½è¯è§£é‡ŠåŸç†
- ğŸ“Š æµç¨‹å›¾å±•ç¤ºé€»è¾‘
- ğŸ’» ä»£ç ç¤ºä¾‹è¯´æ˜å®ç°
- â“ é—®ç­”æ–¹å¼å¸®ä½ ç†è§£

è®©æˆ‘ä»¬ä¸€èµ·æ”»å…‹è¿™ä¸ªç²¾å½©çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼ğŸš€
